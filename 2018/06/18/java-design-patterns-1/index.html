<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Java 设计模式 (1)"><meta name="keywords" content="java,design patterns"><meta name="author" content="upupming"><meta name="copyright" content="upupming"><title>Java 设计模式 (1) | upupming 的博客</title><link rel="shortcut icon" href="/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#1B9EF3"><meta name="msapplication-TileColor" content="#1B9EF3"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#1B9EF3"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-2188191456032650',
  enable_page_level_ads: 'true'
});
</script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?295ad5c5a196e4964e20f74260711177";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-114899088-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"5WEDOKLFCL","apiKey":"26a57bfa5275b7c98a3b3ab7dae61915","indexName":"upupming-blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#creational-patterns-创建型模式"><span class="toc-number">1.</span> <span class="toc-text"> Creational patterns | 创建型模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#structural-patterns-结构型模式"><span class="toc-number">2.</span> <span class="toc-text"> Structural patterns | 结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#adapter-design-pattern-适配器模式"><span class="toc-number">2.1.</span> <span class="toc-text"> Adapter design pattern | 适配器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#decorator-design-pattern-装饰器模式"><span class="toc-number">2.2.</span> <span class="toc-text"> Decorator design pattern | 装饰器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#facade-design-pattern-外观模式"><span class="toc-number">2.3.</span> <span class="toc-text"> Facade design pattern | 外观模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#behavioral-patterns-行为型模式"><span class="toc-number">3.</span> <span class="toc-text"> Behavioral patterns | 行为型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#strategy-design-pattern-策略模式"><span class="toc-number">3.1.</span> <span class="toc-text"> Strategy design pattern | 策略模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#template-design-pattern-模板模式"><span class="toc-number">3.2.</span> <span class="toc-text"> Template design pattern | 模板模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iterator-design-pattern-迭代器模式"><span class="toc-number">3.3.</span> <span class="toc-text"> Iterator design pattern | 迭代器模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text"> 总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">5.</span> <span class="toc-text"> 参考资料</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/doraemon.jpeg"></div><div class="author-info__name text-center">upupming</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">41</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">49</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">26</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://molunerfinn.com/">MARKSZのBlog</a><a class="author-info-links__name text-center" href="https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md">提问的智慧</a><a class="author-info-links__name text-center" href="https://zh.wikipedia.org/">中文维基百科</a><a class="author-info-links__name text-center" href="https://zbqtesla.github.io">ZBQTesla的博客</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/background.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">upupming 的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="https://mirror.upupming.site">Mirror</a><a class="site-page" href="https://music.wxhbts.com">音乐</a><a class="site-page" href="https://writing.upupming.site">Writing</a><a class="site-page" href="/about">关于</a><a class="site-page" href="/rss">RSS</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Java 设计模式 (1)</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-18</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/编程语言/">编程语言</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/编程语言/Java/">Java</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.5k</span><span class="post-meta__separator">|</span><span>阅读时长: 16 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>本系列主要介绍了常用的面向复用的设计模式，包括<em>创建型模式</em>（Creational Patterns）、<em>结构型模式</em>（Structural Patterns）和<em>行为型模式</em>（Behavioral Patterns）。</p>
<figure class="not-code"><img src="/2018/06/18/java-design-patterns-1/list-of-patterns.png">
<figcaption>23 个经典设计模式</figcaption>
</figure>
<a id="more"></a>
<h1 id="creational-patterns-创建型模式"><a class="markdownIt-Anchor" href="#creational-patterns-创建型模式"></a> Creational patterns | 创建型模式</h1>
<p>一些工厂模式，帮助简化对象创建过程。</p>
<h1 id="structural-patterns-结构型模式"><a class="markdownIt-Anchor" href="#structural-patterns-结构型模式"></a> Structural patterns | 结构型模式</h1>
<p>利用现有类和对象组成更大的数据结构。比如将两个或更多的类进行集成产生更复杂的类，同时还有可能增加新的功能。</p>
<h2 id="adapter-design-pattern-适配器模式"><a class="markdownIt-Anchor" href="#adapter-design-pattern-适配器模式"></a> Adapter design pattern | 适配器模式</h2>
<p><strong>问题描述：</strong></p>
<p>假设你有一个在线交易网站，运行的是第三方<a href="https://baike.baidu.com/item/%E6%94%AF%E4%BB%98%E7%BD%91%E5%85%B3" target="_blank" rel="noopener">支付网关</a> <code>Xpay</code>（这里体现为通过 <code>Xpay</code> 的实例记录一个用户的所有信息）。现在供应商只允许你使用新的支付网关（更加安全可靠） <code>PayD</code>，但是原有的代码都是使用 <code>Xpay</code> 的，与 <code>PayD</code> 不兼容。</p>
<img src="before-change.png" height="150">
<img src="change-incompatible.png" height="150">
<p><strong>解决方案：</strong></p>
<p>你在原有代码和 <code>PayD</code> 之间加了一个适配器（Apapter），这样既保证了使用新的支付网关，有保证了原有的代码还能够运行。</p>
<img src="added-adapter.png" height="150">
<p><strong>代码：</strong></p>
<p>原有的 <code>Xpay</code> 接口。</p>
<details><summary>Xpay.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.adapterpattern.xpay;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Xpay</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCreditCardNo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustomerName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCardExpMonth</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCardExpYear</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Short <span class="title">getCardCVVNo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getAmount</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreditCardNo</span><span class="params">(String creditCardNo)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerName</span><span class="params">(String customerName)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardExpMonth</span><span class="params">(String cardExpMonth)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardExpYear</span><span class="params">(String cardExpYear)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardCVVNo</span><span class="params">(Short cardCVVNo)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAmount</span><span class="params">(Double amount)</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>原有 <code>Xpay</code> 接口的实现。</p>
<details><summary>XpayImpl.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.adapterpattern.site;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.javacodegeeks.patterns.adapterpattern.xpay.Xpay;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XpayImpl</span> <span class="keyword">implements</span> <span class="title">Xpay</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String creditCardNo;</span><br><span class="line">    <span class="keyword">private</span> String customerName;</span><br><span class="line">    <span class="keyword">private</span> String cardExpMonth;</span><br><span class="line">    <span class="keyword">private</span> String cardExpYear;</span><br><span class="line">    <span class="keyword">private</span> Short cardCVVNo;</span><br><span class="line">    <span class="keyword">private</span> Double amount;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCreditCardNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> creditCardNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustomerName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCardExpMonth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cardExpMonth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCardExpYear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cardExpYear;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Short <span class="title">getCardCVVNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cardCVVNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreditCardNo</span><span class="params">(String creditCardNo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.creditCardNo = creditCardNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerName</span><span class="params">(String customerName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerName = customerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardExpMonth</span><span class="params">(String cardExpMonth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cardExpMonth = cardExpMonth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardExpYear</span><span class="params">(String cardExpYear)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cardExpYear = cardExpYear;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardCVVNo</span><span class="params">(Short cardCVVNo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cardCVVNo = cardCVVNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAmount</span><span class="params">(Double amount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>新来的 <code>PayD</code> 接口。</p>
<details><summary>PayD.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.adapterpattern.payd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PayD</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustCardNo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCardOwnerName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCardExpMonthDate</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCVVNo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getTotalAmount</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustCardNo</span><span class="params">(String custCardNo)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardOwnerName</span><span class="params">(String cardOwnerName)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardExpMonthDate</span><span class="params">(String cardExpMonthDate)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCVVNo</span><span class="params">(Integer cVVNo)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalAmount</span><span class="params">(Double totalAmount)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>细心观察可以发现，这儿 <code>PayD</code> 的功能基本和 <code>Xpay</code> 一样。</p>
<ul>
<li>getCustCardNo == getCreditCardNo</li>
<li>getCardOwnerName == getCustomerName</li>
<li>getCardExpMonthDate == getCardExpMonth + getCardExpYear</li>
<li>getCVVNo == getCardCVVNo （返回值类型有差别）</li>
<li>getTotalAmount == getAmount</li>
</ul>
<p>为了让原有的代码使用 <code>PayD</code> 做支付网关，必须要在 <code>Xpay</code> 基础上封装出一个适配器 <code>XpayToPayDAdapter</code>，这个适配器实现了 <code>PayD</code> ，在内部有 <code>Xpay</code> 作为变量。在内使用 <code>Xpay</code>，在外表现为 <code>PayD</code>。</p>
<details><summary>XpayToPayDAdapter.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.adapterpattern.site;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.javacodegeeks.patterns.adapterpattern.payd.PayD;</span><br><span class="line"><span class="keyword">import</span> com.javacodegeeks.patterns.adapterpattern.xpay.Xpay;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XpayToPayDAdapter</span> <span class="keyword">implements</span> <span class="title">PayD</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String custCardNo;</span><br><span class="line">    <span class="keyword">private</span> String cardOwnerName;</span><br><span class="line">    <span class="keyword">private</span> String cardExpMonthDate;</span><br><span class="line">    <span class="keyword">private</span> Integer cVVNo;</span><br><span class="line">    <span class="keyword">private</span> Double totalAmount;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Xpay xpay;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XpayToPayDAdapter</span><span class="params">(Xpay xpay)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.xpay = xpay;</span><br><span class="line">        setProp();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustCardNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custCardNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCardOwnerName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cardOwnerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCardExpMonthDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cardExpMonthDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCVVNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cVVNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getTotalAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalAmount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustCardNo</span><span class="params">(String custCardNo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custCardNo = custCardNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardOwnerName</span><span class="params">(String cardOwnerName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cardOwnerName = cardOwnerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCardExpMonthDate</span><span class="params">(String cardExpMonthDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cardExpMonthDate = cardExpMonthDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCVVNo</span><span class="params">(Integer cVVNo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cVVNo = cVVNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalAmount</span><span class="params">(Double totalAmount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalAmount = totalAmount;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setProp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        setCardOwnerName(<span class="keyword">this</span>.xpay.getCustomerName());</span><br><span class="line">        setCustCardNo(<span class="keyword">this</span>.xpay.getCreditCardNo());</span><br><span class="line">        setCardExpMonthDate(<span class="keyword">this</span>.xpay.getCardExpMonth()+<span class="string">"/"</span>+<span class="keyword">this</span>.xpay.getCardExpYear());</span><br><span class="line">        setCVVNo(<span class="keyword">this</span>.xpay.getCardCVVNo().intValue());</span><br><span class="line">        setTotalAmount(<span class="keyword">this</span>.xpay.getAmount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>在客户端使用的时候利用旧的 <code>Xpay</code> 产生新的 <code>PayD</code>，之后所有操作通过 <code>PayD</code> 进行。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 此处使用 Xpay</span></span><br><span class="line">Xpay xpay = <span class="keyword">new</span> XpayImpl();</span><br><span class="line">xpay.setCreditCardNo(<span class="string">"4789565874102365"</span>);</span><br><span class="line">xpay.setCustomerName(<span class="string">"Max Warner"</span>);</span><br><span class="line">xpay.setCardExpMonth(<span class="string">"09"</span>);</span><br><span class="line">xpay.setCardExpYear(<span class="string">"25"</span>);</span><br><span class="line">xpay.setCardCVVNo((<span class="keyword">short</span>)<span class="number">235</span>);</span><br><span class="line">xpay.setAmount(<span class="number">2565.23</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不再允许使用 Xpay，必须使用 PayD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用适配器将 Xpay 转换为 PayD</span></span><br><span class="line">PayD payD = <span class="keyword">new</span> XpayToPayDAdapter(xpay);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 再去使用新的 PayD</span></span><br><span class="line">System.out.println(payD.getCardOwnerName());</span><br><span class="line">System.out.println(payD.getCustCardNo());</span><br><span class="line">System.out.println(payD.getCardExpMonthDate());</span><br><span class="line">System.out.println(payD.getCVVNo());</span><br><span class="line">System.out.println(payD.getTotalAmount());</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong></p>
<p>当想使用一种新的接口，却发现和旧的代码不兼容时，可以加一个适配器来让旧的代码仍起作用。</p>
<p><code>XpayToPayDAdapter</code> 内部有一个 <code>Xpay</code> 的实例，是 Delegation 中的 <a href="../../../../2018/06/05/java-UML/#%E5%9B%9B%E7%A7%8D-Delegation-%E8%BE%A8%E6%9E%90">Aggregation</a>。</p>
<h2 id="decorator-design-pattern-装饰器模式"><a class="markdownIt-Anchor" href="#decorator-design-pattern-装饰器模式"></a> Decorator design pattern | 装饰器模式</h2>
<p>装饰器内部有一个变量，在这个变量基础上增加一些其他功能，类似于锦上添花，称之为“装饰”。这样的模式非常简洁易懂，客户端需要某种功能，只需调用相应的装饰者。</p>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="decorator-uml.png" height="300">
<p>在上图中，抽象类 <code>Decorator</code> 有两条到 <code>Component</code> 的连线，左边一条表示 <code>Decorator</code> 实现了 <code>Component</code>，右边一条表示 <code>Decorator</code> 内部含有 <code>Component</code> 型的变量，这是一种 <a href="../../../../2018/06/05/java-UML/#%E5%9B%9B%E7%A7%8D-Delegation-%E8%BE%A8%E6%9E%90">Aggregation</a>。</p>
<p><strong>代码：</strong></p>
<p>首先有一个接口。</p>
<details><summary>Pizza.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.decoratorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>这个接口被抽象的装饰器实现。</p>
<details><summary>PizzaDecorator.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.decoratorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaDecorator</span> <span class="keyword">implements</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Toppings"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>又有一个具体的类来继承实现这个装饰器的抽象方法。</p>
<details><summary>Chicken.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.decoratorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chicken</span> <span class="keyword">extends</span> <span class="title">PizzaDecorator</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Pizza pizza;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Chicken</span><span class="params">(Pizza pizza)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pizza.getDesc()+<span class="string">", Chicken (12.75)"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pizza.getPrice()+<span class="number">12.75</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>可以看到这个实现是在原来的基础增加了更多的功能（这里是以输出表现）。</p>
<p>而普通的未经过装饰的实现是这样的。</p>
<details><summary>SimplyVegPizza.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.decoratorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplyVegPizza</span> <span class="keyword">implements</span> <span class="title">Pizza</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SimplyVegPizza (230)"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">230</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>客户端可以通过层层装饰来获得新功能。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">pizza = <span class="keyword">new</span> SimplyNonVegPizza();</span><br><span class="line"></span><br><span class="line">pizza = <span class="keyword">new</span> Meat(pizza);</span><br><span class="line">pizza = <span class="keyword">new</span> Cheese(pizza);</span><br><span class="line">pizza = <span class="keyword">new</span> Cheese(pizza);</span><br><span class="line">pizza = <span class="keyword">new</span> Ham(pizza);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"Desc: "</span>+pizza.getDesc());</span><br><span class="line">System.out.println(<span class="string">"Price: "</span>+dformat.format(pizza.getPrice()));</span><br></pre></td></tr></table></figure>
<p>恭喜你到此得到了一份有 meat、cheese（两个哦）、ham 的 pizza😃 ，不过你也得付更多的钱。</p>
<p><strong>总结：</strong></p>
<p>装饰器模式同样利用了 Delegation 中的 <a href="../../../../2018/06/05/java-UML/#%E5%9B%9B%E7%A7%8D-Delegation-%E8%BE%A8%E6%9E%90">Aggregation</a>，这与适配器模式非常相似，不过它是为了增加新的功能而不是适配客户端与 API。对于 Delegation 和继承两种方式的优缺点的探讨也很简单，多数围绕着动态、静态，灵活性方面。这里 Delegation 的作用无疑发挥到了极致。</p>
<h2 id="facade-design-pattern-外观模式"><a class="markdownIt-Anchor" href="#facade-design-pattern-外观模式"></a> Facade design pattern | 外观模式</h2>
<p>对于一个复杂的系统，有很多小接口，将需要利用很多小操作实现的一个复杂操作封装成外观供客户端直接调用，简化了操作，但并不提供原有系统的全部功能。</p>
<p>同时还有解耦的作用，要改动调用时，客户端调用操作不必修改，只需修改外观。</p>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="facade-uml.png" height="300">
<p><strong>代码：</strong></p>
<p>一个复杂的系统有很多小操作。</p>
<details><summary>ScheduleServer.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.facadepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleServer</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startBooting</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Starts booting..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readSystemConfigFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Reading system config files..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Initializing..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initializeContext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Initializing context..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initializeListeners</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Initializing listeners..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createSystemObjects</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Creating system objects..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">releaseProcesses</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Releasing processes..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Destorying..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroySystemObjects</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Destroying system objects..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destoryListeners</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Destroying listeners..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destoryContext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Destroying context..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Shutting down..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>可是我们只需要开机、关机，希望简化一下，就得到了我们的外观。</p>
<details><summary>ScheduleServerFacade.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.facadepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleServerFacade</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ScheduleServer scheduleServer;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScheduleServerFacade</span><span class="params">(ScheduleServer scheduleServer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.scheduleServer = scheduleServer;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startServer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        scheduleServer.startBooting();</span><br><span class="line">        scheduleServer.readSystemConfigFile();</span><br><span class="line">        scheduleServer.init();</span><br><span class="line">        scheduleServer.initializeContext();</span><br><span class="line">        scheduleServer.initializeListeners();</span><br><span class="line">        scheduleServer.createSystemObjects();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopServer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        scheduleServer.releaseProcesses();</span><br><span class="line">        scheduleServer.destory();</span><br><span class="line">        scheduleServer.destroySystemObjects();</span><br><span class="line">        scheduleServer.destoryListeners();</span><br><span class="line">        scheduleServer.destoryContext();</span><br><span class="line">        scheduleServer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h1 id="behavioral-patterns-行为型模式"><a class="markdownIt-Anchor" href="#behavioral-patterns-行为型模式"></a> Behavioral patterns | 行为型模式</h1>
<p>与<strong>算法</strong>有关，与对象之间的任务分配相关。这种模式同时表示了类和对象之间的一种联系，能够让你在运行时做一些决策，避免了很多头疼的问题。</p>
<h2 id="strategy-design-pattern-策略模式"><a class="markdownIt-Anchor" href="#strategy-design-pattern-策略模式"></a> Strategy design pattern | 策略模式</h2>
<p>**问题描述：**对同一项任务，可能会有不同的实现方式，客户端可以根据需要在运行时动态选择地合适的方式。</p>
<p><strong>例子：</strong></p>
<ul>
<li><em>排序算法</em>有<strong>冒泡排序</strong>、<strong>归并排序</strong>、<strong>快速排序</strong>等等。</li>
<li><em>支付方式</em>有<strong>现金支付</strong>、<strong>银行卡支付</strong>、<strong>微信支付</strong>等等。</li>
<li><em><code>List</code></em> 的实现策略有 <strong><code>ArrayList</code></strong>、<strong><code>LinkedList</code></strong>、<strong><code>CopyOnWriteArrayList</code></strong>。</li>
</ul>
<p><strong>解决方案</strong>：创建一个 Interface，在这个 Interface 的每个实现中使用不同的算法。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>易于扩展新算法</li>
<li>将算法与客户端操作分离开来</li>
</ul>
<p><strong><a href="../../../../2018/06/05/java-UML/">UML 类图</a>：</strong></p>
<iframe frameborder="0" style="width:100%;height:400px;" src="https://www.draw.io/?lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1#R7Vnbjts2EP0aAZuHXehq2Y%2BWdjctsGmNboC2j7RES0QoUaDoW76%2BQ4nU3Y2SdZEU8cLAiofDoTjnDDmmDSfMTu85KtIPLMbUsM34ZDiPhm1b7tKGfxI518jSW9ZAwkmsjFrglXzGCjQVuicxLnuGgjEqSNEHI5bnOBI9DHHOjn2zHaP9WQuU4BHwGiE6Rv8ksUjVKmy%2FxX%2FBJEn1zNZiVfdsUfQp4Wyfq%2FkM29lVf3V3hrQvtdAyRTE7diDnyXBCzpion7JTiKmMrQ5bPe75Qm%2Fz3hznYs4AxdMB0b1auhHaxjogucB8hyIsm0Fg2AtYCbDjBBt0zsD5q%2BBI4OSsliHOOnTlkWQU5dAKdkza1T1yKKIkyeE5wtI7AAfMBYGor1WHYAWgUUpo%2FILObC%2BXUAoIqW4FKePkM7hFFLosAKCbCyWghdezeJUj1dQcl2Cz0XGxBtAHdOoZvqBSKCBilKKiJNtqGXJghnhC8oAJwTJlpBf9TCgNGWW8ioWmXkWifklb2o9pUszJiOBTB1K0vccsw4JDuE3dayoJqRTz3EXdPraCdVxlk3bFaqpcRCpJksZ3KxR4UFqZ1o031o0dFOh8hzIQP8y0jtkeQvZupA9Ynqh44%2BwT1rHKWS2YTvgUpDVD8U5cVExZoIjkyUtl8%2Bi2yB9q2RJiMHZHq2RLSRzjXLLNBBJo2yi0YCD8KixeAB%2BIXmg%2BeIYHLx5C22rb8JHmXIQsh7UgUhGJQTdHLLUzg3J7NuWK4oU3j2HXeTvB%2FohgSPxCJtWPl%2Feu%2BxPlvWf1836h2x1VrLwJVdiO%2BXZZLEeyuMcZIvRXSIc1aANyrnNW3BeoLI%2BMx1Odt53hoij82aJQIoAMmKWBlft2Cawmtv4Bk5RUDNVM6gLK%2BiYaMyCE4pa3j5LWx3trxK0z5taZ4JGiLaYbVhJBmPTPa9sBv1%2Bi8AqUWc5yHmdXOK31FtE%2FrutKL6qWuI8EkFLVeoMC767K704Ch8Wxzed3vYS%2BUAHcUv4%2FSHlrot6b1s8Vct4af08IOY6JCBGPf8iSYPkTlwT2REmwXE1Iw1lcoSSwnHFNkKMMTxYEEejlt322lZxPdR8Ok3gMAvt993QqCLzbrZb4mo2lSd35xcT4YJpUj2VdY2dxb%2BXEVVizFvY82q5RT0x%2B%2Fb9QT4wPirvB9hBO7gphfzMIJ%2FeAW%2F3x3bYJy595ylira5wyiy%2FvEzhOsC4yMN2y41MLBKnIdKGA83gtL4mhuaVMFgZBZQ5tTWltJc9wRUaMyhTHykGV9UFz1ds55p%2BrPzn6RMRfcmsxH0zTVcDf0tmD5duqvcGcQCSk7B%2F%2FtRaAyibBClK5JxfbsynZnke9e%2FQxdR2qmvvDLlW%2Bcs4xRYIc%2BhNM0aem2Eipdu4mlxcKEu2iflc1qns9PXDUXG9pzdkDR3VgRo6AXnTumKlUuvjC7qo%2Fz9LsXZvDQ%2B2xlWoT1HnqHV%2Bn%2FS%2FUOxSvVLPjX1AviJaf61Ge72ugGWZrZLbqe4r2xplgT2bCd1O95w%2FEOtz3Zqt%2BeLU%2FvLm7kurtld%2Bbx%2FHdt6gemu0PV7V5%2B%2Bug8%2FQP"></iframe>
<p><strong>代码：</strong></p>
<p>定义支付策略接口。</p>
<details><summary>PaymentStrategy.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A strategy interface for paying money.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> upupming</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentStrategy</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(<span class="keyword">double</span> amount)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>具体的实现方式有两种。</p>
<details><summary>PaypalStrategy</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Paying using paypal.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> upupming</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaypalStrategy</span> <span class="keyword">implements</span> <span class="title">PaymentStrategy</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String emailId;</span><br><span class="line">  <span class="keyword">private</span> String password;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">PaypalStrategy</span><span class="params">(String email, String pwd)</span> </span>&#123;</span><br><span class="line">    emailId = email;</span><br><span class="line">    password = pwd;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(<span class="keyword">double</span> amount)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Email: "</span> + emailId);</span><br><span class="line">    System.out.println(<span class="string">"Password: "</span> + password);</span><br><span class="line">    System.out.println(amount + <span class="string">"paid using Paypal"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>CreditCardStrategy.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Paying using credit card</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> upupming</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreditCardStrategy</span> <span class="keyword">implements</span> <span class="title">PaymentStrategy</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> String cardNumber;</span><br><span class="line">  <span class="keyword">private</span> String cvv;</span><br><span class="line">  <span class="keyword">private</span> String dateOfExpiry;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CreditCardStrategy</span><span class="params">(String name, String cardNumber, String cvv, </span></span></span><br><span class="line"><span class="function"><span class="params">        String dateOfExpiry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.cardNumber = cardNumber;</span><br><span class="line">    <span class="keyword">this</span>.cvv = cvv;</span><br><span class="line">    <span class="keyword">this</span>.dateOfExpiry = dateOfExpiry;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(<span class="keyword">double</span> amount)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Name: "</span> + name);</span><br><span class="line">    System.out.println(<span class="string">"Card Number: "</span> + cardNumber);</span><br><span class="line">    System.out.println(<span class="string">"CVV: "</span> + cvv);</span><br><span class="line">    System.out.println(<span class="string">"Date of expiry: "</span> + dateOfExpiry);</span><br><span class="line">    System.out.println(amount + <span class="string">"paid with credit card"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>在其他地方使用，根据传入的策略参数进行支付。</p>
<details><summary>ShoppingCart.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A Shopping cart which keeps the goods, and pays using a </span></span><br><span class="line"><span class="comment"> * provided strategy.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> upupming</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShoppingCart</span> </span>&#123;</span><br><span class="line">  <span class="keyword">double</span> total = <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addGoods</span><span class="params">(<span class="keyword">double</span> amount)</span> </span>&#123;</span><br><span class="line">    total += amount;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(PaymentStrategy paymentStrategy)</span> </span>&#123;</span><br><span class="line">    paymentStrategy.pay(total);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h2 id="template-design-pattern-模板模式"><a class="markdownIt-Anchor" href="#template-design-pattern-模板模式"></a> Template design pattern | 模板模式</h2>
<p>做事情的步骤一样,但具体方法不同。</p>
<p>给一类算法定一套模板，你之后的实现应该能够包含一些固定的操作，但是又有一些灵活度。</p>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="template-uml.png" height="300">
<p>抽象类 <code>AbstractClass</code> 有一些关于某个算法的原始操作，在子类 <code>ConcreteClass</code> 中可以具体的实现这些操作。在 <code>TemplateMethod</code> 中调用这些原始操作。</p>
<p><strong>代码：</strong></p>
<p>首先定义一个连接模板，里面的 <code>run()</code>（即 TemplateMethod） 已经定义，调用一些其他方法（即 PrimitiveOperation），其中包括一些抽象方法，在不同的连接情况下，这些抽象方法的实现有所不同（比如 <code>setDBDriver</code>）</p>
<details><summary>ConnectionTemplate.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.templatepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionTemplate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isLoggingEnable = <span class="keyword">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConnectionTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        isLoggingEnable = disableLogging();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        setDBDriver();</span><br><span class="line">        logging(<span class="string">"Drivers set ["</span>+<span class="keyword">new</span> Date()+<span class="string">"]"</span>);</span><br><span class="line">        setCredentials();</span><br><span class="line">        logging(<span class="string">"Credentails set ["</span>+<span class="keyword">new</span> Date()+<span class="string">"]"</span>);</span><br><span class="line">        connect();</span><br><span class="line">        logging(<span class="string">"Conencted"</span>);</span><br><span class="line">        prepareStatement();</span><br><span class="line">        logging(<span class="string">"Statement prepared ["</span>+<span class="keyword">new</span> Date()+<span class="string">"]"</span>);</span><br><span class="line">        setData();</span><br><span class="line">        logging(<span class="string">"Data set ["</span>+<span class="keyword">new</span> Date()+<span class="string">"]"</span>);</span><br><span class="line">        insert();</span><br><span class="line">        logging(<span class="string">"Inserted ["</span>+<span class="keyword">new</span> Date()+<span class="string">"]"</span>);</span><br><span class="line">        close();</span><br><span class="line">        logging(<span class="string">"Conenctions closed ["</span>+<span class="keyword">new</span> Date()+<span class="string">"]"</span>);</span><br><span class="line">        destroy();</span><br><span class="line">        logging(<span class="string">"Object destoryed ["</span>+<span class="keyword">new</span> Date()+<span class="string">"]"</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setDBDriver</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setCredentials</span><span class="params">()</span></span>; </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Setting connection..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepareStatement</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Preparing insert statement..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Inserting data..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Closing connections..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Destroying connection objects..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">disableLogging</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">logging</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isLoggingEnable)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Logging....: "</span>+msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>继承抽象模板，完成抽象方法的实现。下面是 MySql 的例子。</p>
<details><summary>MySqLCSVCon.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.templatepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySqLCSVCon</span> <span class="keyword">extends</span> <span class="title">ConnectionTemplate</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDBDriver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Setting MySQL DB drivers..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCredentials</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Setting credentials for MySQL DB..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Setting up data from csv file...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">disableLogging</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><strong>总结：</strong></p>
<p>模板留出抽象方法待子类实现。这种策略在 Junit 测试文件中也经常用到。比如在上面的例子中我可以写一个抽象测试类 <code>ConnectionTemplateTest</code>，然后用 <code>MySqLCSVConTest</code> 继承这个类来测试 <code>MySqLCSVCon</code>，可以节省很多代码。</p>
<p>看到抽象类中某方法调用未实现的抽象方法，就会主动去想到这种实现方式是模板模式。</p>
<h2 id="iterator-design-pattern-迭代器模式"><a class="markdownIt-Anchor" href="#iterator-design-pattern-迭代器模式"></a> Iterator design pattern | 迭代器模式</h2>
<p>让数据结构具有迭代功能。</p>
<img src="iterator-uml.png" height="200">
<p>Java 自带 <code>Iterator</code> 接口，用自己的 <code>ConcreteIterator</code> 实现这个接口，同时在内部 aggregate 一些 <code>ConcreteAggregate</code>。</p>
<p>比如 <code>ShapeIterator</code> 就会在内部拥有 <code>Shape</code> 变量数组。</p>
<p><strong>代码：</strong></p>
<p>一个简单而又朴素的形状。</p>
<details><summary>Shape.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.iteratorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Shape</span><span class="params">(<span class="keyword">int</span> id, String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ID: "</span>+id+<span class="string">" Shape: "</span>+name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>为了遍历一个 <code>Shape</code> 数组，要实现 <code>Iterator&lt;Shape&gt;</code>，在内部 aggregate 一些 <code>Shapes</code> 用于操作。</p>
<details><summary>ShapeIterator.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.iteratorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Shape</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Shape [] shapes;</span><br><span class="line">    <span class="keyword">int</span> pos; <span class="comment">// pos 初始值为 0</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShapeIterator</span><span class="params">(Shape []shapes)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shapes = shapes;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// 1. 实现 hasNext()：有下一个元素，下一个元素是 shapes[pos]</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(pos &gt;= shapes.length || shapes[pos] == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 实现 next()：返回下一个元素，第一次返回的是 shapes[0]</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shape <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shapes[pos++];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 实现 remove()</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// pos==0，代表还未开始遍历，游标处于-1，还不能删除</span></span><br><span class="line">    <span class="comment">// 必须有过一次 next()调用之后才可以 remove</span></span><br><span class="line">        <span class="keyword">if</span>(pos &lt;=<span class="number">0</span> )</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Illegal position"</span>);</span><br><span class="line">        <span class="keyword">if</span>(shapes[pos-<span class="number">1</span>] !=<span class="keyword">null</span>)&#123;</span><br><span class="line">      <span class="comment">// 可以看到这儿的代价比较高，是线性时间</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i= pos-<span class="number">1</span>; i&lt;(shapes.length-<span class="number">1</span>);i++)&#123;</span><br><span class="line">                shapes[i] = shapes[i+<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            shapes[shapes.length-<span class="number">1</span>] = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>对于客户端来说，用起来非常简洁，三个方法轮番调用。</p>
<details><summary>TestIteratorPattern.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.iteratorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestIteratorPattern</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShapeStorage storage = <span class="keyword">new</span> ShapeStorage();</span><br><span class="line">         storage.addShape(<span class="string">"Polygon"</span>);</span><br><span class="line">        storage.addShape(<span class="string">"Hexagon"</span>);</span><br><span class="line">        storage.addShape(<span class="string">"Circle"</span>);</span><br><span class="line">        storage.addShape(<span class="string">"Rectangle"</span>);</span><br><span class="line">        storage.addShape(<span class="string">"Square"</span>);</span><br><span class="line">        </span><br><span class="line">        ShapeIterator iterator = <span class="keyword">new</span> ShapeIterator(storage.getShapes());</span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"Apply removing while iterating..."</span>);</span><br><span class="line">        iterator = <span class="keyword">new</span> ShapeIterator(storage.getShapes());</span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">      <span class="comment">// 这种方式解决了普通 for 循环无法边便利边删除数组中元素的问题</span></span><br><span class="line">            iterator.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>ShapeStorage.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.iteratorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeStorage</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Shape []shapes = <span class="keyword">new</span> Shape[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addShape</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = index++;</span><br><span class="line">        shapes[i] = <span class="keyword">new</span> Shape(i,name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Shape[] getShapes()&#123;</span><br><span class="line">        <span class="keyword">return</span> shapes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h1 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h1>
<table>
<thead>
<tr>
<th style="text-align:center">创建型模式</th>
<th style="text-align:center">结构型模式</th>
<th style="text-align:center">行为型模式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">适配器模式</td>
<td style="text-align:center">策略模式</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">装饰器模式</td>
<td style="text-align:center">模板模式</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">外观模式</td>
<td style="text-align:center">迭代器模式</td>
</tr>
</tbody>
</table>
<h1 id="参考资料"><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h1>
<ol>
<li><a href="https://github.com/upupming/books/blob/master/Programming-Languages/java/Java-Design-Patterns.pdf" target="_blank" rel="noopener">Java Design Patterns</a></li>
<li>Software Construction at HIT | 5.3 Design Patterns for Reuse</li>
<li><a href="https://legacy.gitbook.com/book/quanke/design-pattern-java/details" target="_blank" rel="noopener">设计模式Java版</a></li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">upupming</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://upupming.site/2018/06/18/java-design-patterns-1/">https://upupming.site/2018/06/18/java-design-patterns-1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://upupming.site">upupming 的博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/design-patterns/">design patterns</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/06/19/java-design-patterns-2/"><i class="fa fa-chevron-left">  </i><span>Java 设计模式 (2)</span></a></div><div class="next-post pull-right"><a href="/2018/06/15/6.031-locks-and-synchronization/"><span>Notes for MIT 6.031 Locks and Synchronization</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '77bd7cc3fdbcd3e5945a',
  clientSecret: '883971da140a8232d72918030f8c1a211a5befc1',
  repo: 'upupming.github.io',
  owner: 'upupming',
  admin: 'upupming',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(/img/background.png)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2020 By upupming</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/algolia.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>