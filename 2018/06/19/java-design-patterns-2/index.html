<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Java 设计模式 (2)"><meta name="keywords" content="java,design patterns"><meta name="author" content="upupming"><meta name="copyright" content="upupming"><title>Java 设计模式 (2) | upupming 的博客</title><link rel="shortcut icon" href="/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#1B9EF3"><meta name="msapplication-TileColor" content="#1B9EF3"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#1B9EF3"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-2188191456032650',
  enable_page_level_ads: 'true'
});
</script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?295ad5c5a196e4964e20f74260711177";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-114899088-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"5WEDOKLFCL","apiKey":"26a57bfa5275b7c98a3b3ab7dae61915","indexName":"upupming-blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#creational-patterns-创建型模式"><span class="toc-number">1.</span> <span class="toc-text"> Creational patterns | 创建型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#simple-factory-design-pattern-简单工厂模式"><span class="toc-number">1.1.</span> <span class="toc-text"> Simple factory design pattern | 简单工厂模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#factory-method-design-pattern-工厂方法模式"><span class="toc-number">1.2.</span> <span class="toc-text"> Factory method design pattern | 工厂方法模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#abstract-factory-method-pattern-抽象工厂模式"><span class="toc-number">1.3.</span> <span class="toc-text"> Abstract factory method pattern | 抽象工厂模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#build-design-pattern-构建者模式"><span class="toc-number">1.4.</span> <span class="toc-text"> Build design pattern | 构建者模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#structural-patterns-结构型模式"><span class="toc-number">2.</span> <span class="toc-text"> Structural patterns | 结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bridge-design-pattern-桥接模式"><span class="toc-number">2.1.</span> <span class="toc-text"> Bridge design pattern | 桥接模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#proxy-design-pattern-代理模式"><span class="toc-number">2.2.</span> <span class="toc-text"> Proxy design pattern | 代理模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#composite-组合模式"><span class="toc-number">2.3.</span> <span class="toc-text"> Composite | 组合模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#behavioral-patterns-行为型模式"><span class="toc-number">3.</span> <span class="toc-text"> Behavioral patterns | 行为型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#observer-design-pattern-观察者模式"><span class="toc-number">3.1.</span> <span class="toc-text"> Observer design pattern | 观察者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#visitor-design-pattern-访问者模式"><span class="toc-number">3.2.</span> <span class="toc-text"> Visitor design pattern | 访问者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mediator-design-pattern-中介者模式"><span class="toc-number">3.3.</span> <span class="toc-text"> Mediator design pattern | 中介者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#command-design-pattern-命令模式"><span class="toc-number">3.4.</span> <span class="toc-text"> Command design pattern | 命令模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chain-of-responsibility-design-pattern-责任链模式"><span class="toc-number">3.5.</span> <span class="toc-text"> Chain of responsibility design pattern | 责任链模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text"> 总结</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/doraemon.jpeg"></div><div class="author-info__name text-center">upupming</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">41</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">49</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">26</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://molunerfinn.com/">MARKSZのBlog</a><a class="author-info-links__name text-center" href="https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md">提问的智慧</a><a class="author-info-links__name text-center" href="https://zh.wikipedia.org/">中文维基百科</a><a class="author-info-links__name text-center" href="https://zbqtesla.github.io">ZBQTesla的博客</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/background.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">upupming 的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="https://mirror.upupming.site">Mirror</a><a class="site-page" href="https://music.wxhbts.com">音乐</a><a class="site-page" href="https://writing.upupming.site">Writing</a><a class="site-page" href="/about">关于</a><a class="site-page" href="/rss">RSS</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Java 设计模式 (2)</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-19</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/编程语言/">编程语言</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/编程语言/Java/">Java</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">8.1k</span><span class="post-meta__separator">|</span><span>阅读时长: 36 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>本系列主要介绍了常用的面向复用的设计模式，包括<em>创建型模式</em>（Creational Patterns）、<em>结构型模式</em>（Structural Patterns）和<em>行为型模式</em>（Behavioral Patterns）。</p>
<figure class="not-code"><img src="/2018/06/18/java-design-patterns-1/list-of-patterns.png">
<figcaption>23 个经典设计模式</figcaption>
</figure>
<a id="more"></a>
<h1 id="creational-patterns-创建型模式"><a class="markdownIt-Anchor" href="#creational-patterns-创建型模式"></a> Creational patterns | 创建型模式</h1>
<p>一些工厂模式，帮助简化对象创建过程。</p>
<img src="creational-patterns.png" height="400">
<h2 id="simple-factory-design-pattern-简单工厂模式"><a class="markdownIt-Anchor" href="#simple-factory-design-pattern-简单工厂模式"></a> Simple factory design pattern | 简单工厂模式</h2>
<p>简单工厂模式并不属于 23 个经典的设计模式。</p>
<p>定义一个工厂类，它可以根据参数的不同返回不同类的实例，被创建的实例通常都具有共同的父类。因为在简单工厂模式中用于创建实例的方法是静态(static)方法，因此简单工厂模式又被称为静态工厂方法(Static Factory Method)模式，它属于类创建型模式。</p>
<p>（其实不用 static 也可以，只是 static 更加好，不必创建 <code>GraphFactory</code> 的实例，就可以调用其中的静态方法。）</p>
<p><strong>代码：</strong></p>
<p>为了简化创建三种图 <code>GraphPoet</code>、<code>SocialNetwork</code>、<code>NetworkTopology</code>过程，直接调用静态方法 <code>createGraph(String filePath, Scanner scanner, String graphType))</code>根据传入的文件路径、输入指令和图类型完成创建操作。</p>
<details><summary>GraphFactory.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> exception.checked.CannotCreateEdgeException;</span><br><span class="line"><span class="keyword">import</span> exception.checked.FileSyntaxException;</span><br><span class="line"><span class="keyword">import</span> exception.checked.NoSuchEdgeTypeException;</span><br><span class="line"><span class="keyword">import</span> graph.ConcreteGraph;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GraphFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConcreteGraph <span class="title">createGraph</span><span class="params">(String filePath, Scanner scanner, String graphType)</span> <span class="keyword">throws</span> FileSyntaxException, IOException, CannotCreateEdgeException, NumberFormatException, NoSuchEdgeTypeException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(graphType.equals(<span class="string">"GraphPoet"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> GraphPoetFactory()).createGraph(filePath, scanner);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (graphType.equals(<span class="string">"SocialNetwork"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> SocialNetworkFactory()).createGraph(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (graphType.equals(<span class="string">"NetworkTopology"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> NetworkTopologyFactory()).createGraph(filePath);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(graphType.equals(<span class="string">"MovieGraph"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> MovieGraphFactory()).createGraph(filePath);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Illegal graph type to be created: "</span> + graphType);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h2 id="factory-method-design-pattern-工厂方法模式"><a class="markdownIt-Anchor" href="#factory-method-design-pattern-工厂方法模式"></a> Factory method design pattern | 工厂方法模式</h2>
<p>简单工厂模式对于新加入的数据类型无法创建，违背“开闭原则”，而且太多分支语句。</p>
<p>上面的代码中使用到的 <code>GraphPoetFactory</code>，就是一个工厂方法模式的例子。</p>
<details><summary>GraphPoetFactory.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GraphPoetFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> FileParser parser;</span><br><span class="line">  <span class="keyword">private</span> GraphPoet poet;</span><br><span class="line">  <span class="keyword">private</span> List&lt;String&gt; args;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> minWeight;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addVertices</span><span class="params">()</span> <span class="keyword">throws</span> LabelFormatException, VertexArgumentsLengthException, VertexTypeException, NoSuchVertexTypeException </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    System.out.println(<span class="string">"vertices have been added"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addEdges</span><span class="params">()</span> <span class="keyword">throws</span> NumberFormatException, EdgeArgumentsLengthException, EdgeDirectionException, NotAGraphPoetEdgeException, VertexNotDefinedException, FileSyntaxException, CannotCreateEdgeException </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> GraphPoet <span class="title">createGraph</span><span class="params">(String filePath, Scanner scanner)</span> <span class="keyword">throws</span> FileSyntaxException, IOException,</span></span><br><span class="line"><span class="function">      CannotCreateEdgeException, NumberFormatException, NotAGraphPoetEdgeException, NoSuchVertexTypeException </span>&#123;</span><br><span class="line">    System.out.print(<span class="string">"\nEnter the minimum weight of edges: "</span>);</span><br><span class="line">    String minWeightString = scanner.nextLine();</span><br><span class="line">    minWeight = Double.parseDouble(minWeightString);</span><br><span class="line"></span><br><span class="line">    parser = <span class="keyword">new</span> FileParser(filePath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// must be a legal graph poet</span></span><br><span class="line">    <span class="keyword">if</span> (!parser.getGraphType().equals(<span class="string">"GraphPoet"</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> GraphTypeException(<span class="string">"GraphPoet"</span>, parser.getGraphType());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    poet = <span class="keyword">new</span> GraphPoet(parser.getGraphName());</span><br><span class="line">    </span><br><span class="line">    addVertices();</span><br><span class="line">    </span><br><span class="line">    addEdges();</span><br><span class="line">        <span class="comment">//assert poet.vertices() != null;</span></span><br><span class="line">    <span class="keyword">return</span> poet;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="factory-method-uml.png" height="250">
<p><code>ConcreteCreator</code> 继承抽象类 <code>Creator</code> 并重写其中的工厂方法，可以产生 <code>ConcreteProduct</code> 的实例，而 <code>ConcreteProduct</code> 又是 <code>Product</code> 的实现。</p>
<p><strong>代码：</strong></p>
<p>有个基本的接口 <code>XMLParser</code>，不同的 Parser 需要具体实现不同的解析方法。</p>
<details><summary>XMLParser.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.factorymethodpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">XMLParser</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">parse</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>这个接口有一种实现方式。</p>
<details><summary>FeedbackXMLParser.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.factorymethodpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeedbackXMLParser</span> <span class="keyword">implements</span> <span class="title">XMLParser</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Parsing feedback XML..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Feedback XML Message"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>一般情况下，用户不太喜欢直接用 new，因为可能还需要很多操作来使构建得到的 <code>XMLParser</code> 符合自己的使用条件。用户希望直接得到一个已经构造好的 <code>FeedbackXMLParser</code>。可以把一系列操作封装到工厂方法中。</p>
<p>抽象类 <code>XMLParserFactory</code> 定义了一个工厂方法 <code>getParser</code>。**注意：**这个例子还用到了模板模式，抽象类中 <code>display</code> 方法调用还未实现的 <code>getParser</code> 方法。</p>
<details><summary>XMLParserFactory.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.factorymethodpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLParserFactory</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">        XMLParser parser = getParser();</span><br><span class="line">        String msg = parser.parse();</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> XMLParser <span class="title">getParser</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><code>FeedbackXMLParserFactory</code> 实现了得到 <code>FeedbackXMLParser</code> 的工厂方法。虽然这里只是简单地 new 了一个新的 <code>FeedbackXMLParser</code>，但是在实际运用中可能这个方法需要完成许多操作，比如从文件中读取数据，构造一个对客户端来说开箱即用的 <code>FeedbackXMLParser</code>。</p>
<details><summary>FeedbackXMLParserFactory.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.factorymethodpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeedbackXMLParserFactory</span> <span class="keyword">extends</span> <span class="title">XMLParserFactory</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> XMLParser <span class="title">getParser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FeedbackXMLParser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>客户端现在可以使用工厂方法来得到好用的对象，不用操心工厂方法是如何构造这个对象的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ParserFactory service = <span class="keyword">new</span> FeedbackXMLParserFactory();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用工厂方法直接得到一个 paser</span></span><br><span class="line">XMLParser parser = service.getParser();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用模板方法，模板方法又调用了工厂方法</span></span><br><span class="line">service.display();</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong></p>
<p>这样做遵循 OCP(Open-Closed Principle) 原则，对扩展开放，可以新增许多 <code>...XMLParser</code>，同时增加其 <code>...XMLParserFactory</code> 作为工厂；对修改已有代码封闭，已有的 <code>XMLParser</code> 还能正常使用。</p>
<p>很多时候抽象类和接口可以相互转换。当认为有一些共性操作可以抽象出来的时候，就可以将接口转为抽象类。当没有所有操作都因具体实现而异的时候，可以选择接口。</p>
<h2 id="abstract-factory-method-pattern-抽象工厂模式"><a class="markdownIt-Anchor" href="#abstract-factory-method-pattern-抽象工厂模式"></a> Abstract factory method pattern | 抽象工厂模式</h2>
<p>对于同一种 UI（按钮、文本框、组合框），在不同的系统下显示有所不同（Spring 风格、Summer 风格）。同样是按钮，只是风格不同，可以抽象一个工厂方法接口，在不同的系统中使用不同的工厂方法子类产生一个按钮实例。</p>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="abstract-factory-uml.png">
<ul>
<li>AbstractFactory（抽象工厂）：它声明了一组用于创建一族产品的方法，每一个方法对应一种产品。</li>
<li>ConcreteFactory（具体工厂）：它实现了在抽象工厂中声明的创建产品的方法，生成一组具体产品，这些产品构成了一个产品族，每一个产品都位于某个产品等级结构中。</li>
<li>AbstractProduct（抽象产品）：它为每种产品声明接口，在抽象产品中声明了产品所具有的业务方法。</li>
<li>ConcreteProduct（具体产品）：它定义具体工厂生产的具体产品对象，实现抽象产品接口中声明的业务方法。</li>
</ul>
<p><strong>代码：</strong></p>
<p>还是最初有一个 <code>XMLParser</code> 接口。</p>
<details><summary>XMLParser.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.abstractfactorypattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">XMLParser</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">parse</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>对比工厂方法模式，抽象工厂模式中的每个工厂都必须要继承一个通用的接口 <code>AbstractParserFactory</code>。</p>
<details><summary>AbstractParserFactory.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.abstractfactorypattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AbstractParserFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> XMLParser <span class="title">getParserInstance</span><span class="params">(String parserType)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>开发者实现这个接口，得到一个具体的工厂。</p>
<details><summary>NYParserFactory.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.abstractfactorypattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NYParserFactory</span> <span class="keyword">implements</span> <span class="title">AbstractParserFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> XMLParser <span class="title">getParserInstance</span><span class="params">(String parserType)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span>(parserType)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"NYERROR"</span>: <span class="keyword">return</span> <span class="keyword">new</span> NYErrorXMLParser();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"NYFEEDBACK"</span>: <span class="keyword">return</span> <span class="keyword">new</span> NYFeedbackXMLParser();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"NYORDER"</span>: <span class="keyword">return</span> <span class="keyword">new</span> NYOrderXMLParser();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"NYRESPONSE"</span>: <span class="keyword">return</span> <span class="keyword">new</span> NYResponseXMLParser();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>这个工厂根据输入的参数创建不同的 <code>XMLParser</code>，比如 <code>NYFeedbackXMLParser</code>。</p>
<details><summary>NYFeedbackXMLParser.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.abstractfactorypattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NYFeedbackXMLParser</span> <span class="keyword">implements</span> <span class="title">XMLParser</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"NY Parsing feedback XML..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"NY Feedback XML Message"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>这样客户端只需要知道自己使用的是 <code>AbstractParserFactory</code>，使用过程中可以是不同的实现，从而得到具体的 Parser。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AbstractParserFactory parserFactory = ParserFactoryProducer.getFactory(<span class="string">"NYFactory"</span>);</span><br><span class="line"><span class="comment">// 现在 parserFactory 是 NYParserFactory 类型</span></span><br><span class="line"><span class="comment">// 据此得到的 XMLParser 将是 NYOrderXMLParser</span></span><br><span class="line">XMLParser parser = parserFactory.getParserInstance(<span class="string">"NYORDER"</span>);</span><br><span class="line">String msg=<span class="string">""</span>;</span><br><span class="line">msg = parser.parse();</span><br><span class="line">System.out.println(msg);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切换 parserFactory 类型</span></span><br><span class="line">parserFactory = ParserFactoryProducer.getFactory(<span class="string">"TWFactory"</span>);</span><br><span class="line">parser = parserFactory.getParserInstance(<span class="string">"TWFEEDBACK"</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong></p>
<p>相比于工厂方法只有一类 <code>XMLParserFactory</code>（可以创建 <code>ErrorXMLParser</code>、<code>FeedbackXMLParser</code>、<code>ResponseXMLParser</code>、<code>OrderXMLParser</code>），抽象工厂在 <code>AbstractParserFactory</code> 基础上可以派生出 <code>NYParserFactory</code>（可以创建 <code>NYErrorXMLParser</code>、<code>NYFeedbackXMLParser</code>、<code>NYResponseXMLParser</code>、<code>NYOrderXMLParser</code>）、<code>TWParserFactory</code>等等。</p>
<h2 id="build-design-pattern-构建者模式"><a class="markdownIt-Anchor" href="#build-design-pattern-构建者模式"></a> Build design pattern | 构建者模式</h2>
<ul>
<li>
<p>汽车由不同组件构成，包括轮胎、方向盘和发动机等多个部件的完整汽车。如何将这些部件组装成一辆完整的汽车并返回给用户？</p>
</li>
<li>
<p>游戏角色性别、脸型、服装、发型等外部特性都有所差异，例如“天使”拥有美丽的面容和披肩的长发，并身穿一袭白裙；而“恶魔”极其丑陋，留着光头并穿一件刺眼的黑衣。如何创建一个游戏角色？</p>
</li>
</ul>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="builder-uml.png">
<p><code>Builder</code> 接口定义了如何创建 <code>Product</code>，<code>SimpleClass</code> 实现 <code>Builder</code>，对 <code>Product</code> 游戏人物进行拆解，开始给游戏人物加入各种定义，提供 <code>getResult()</code> 来让客户端拿到这个游戏人物。<code>Director</code> <a href="../../../../2018/06/05/java-UML/#%E5%9B%9B%E7%A7%8D-Delegation-%E8%BE%A8%E6%9E%90">aggregate</a> <code>Builder</code> 来得到游戏人物。</p>
<p><strong>代码：</strong></p>
<p>一辆汽车有各种组件，你可以定义（<code>set</code>）并且查看（<code>get</code>）。</p>
<details><summary>Car.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.builderpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String bodyStyle;</span><br><span class="line">    <span class="keyword">private</span> String power;</span><br><span class="line">    <span class="keyword">private</span> String engine;</span><br><span class="line">    <span class="keyword">private</span> String breaks;</span><br><span class="line">    <span class="keyword">private</span> String seats;</span><br><span class="line">    <span class="keyword">private</span> String windows;</span><br><span class="line">    <span class="keyword">private</span> String fuelType;</span><br><span class="line">    <span class="keyword">private</span> String carType;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span> <span class="params">(String carType)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.carType = carType;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBodyStyle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bodyStyle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBodyStyle</span><span class="params">(String bodyStyle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bodyStyle = bodyStyle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPower</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> power;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPower</span><span class="params">(String power)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.power = power;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEngine</span><span class="params">(String engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBreaks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> breaks;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBreaks</span><span class="params">(String breaks)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.breaks = breaks;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSeats</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> seats;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSeats</span><span class="params">(String seats)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.seats = seats;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWindows</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> windows;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWindows</span><span class="params">(String windows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.windows = windows;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFuelType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fuelType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFuelType</span><span class="params">(String fuelType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fuelType = fuelType;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">"--------------"</span>+carType+<span class="string">"--------------------- \n"</span>);</span><br><span class="line">        sb.append(<span class="string">" Body: "</span>);</span><br><span class="line">        sb.append(bodyStyle);</span><br><span class="line">        sb.append(<span class="string">"\n Power: "</span>);</span><br><span class="line">        sb.append(power);</span><br><span class="line">        sb.append(<span class="string">"\n Engine: "</span>);</span><br><span class="line">        sb.append(engine);</span><br><span class="line">        sb.append(<span class="string">"\n Breaks: "</span>);</span><br><span class="line">        sb.append(breaks);</span><br><span class="line">        sb.append(<span class="string">"\n Seats: "</span>);</span><br><span class="line">        sb.append(seats);</span><br><span class="line">        sb.append(<span class="string">"\n Windows: "</span>);</span><br><span class="line">        sb.append(windows);</span><br><span class="line">        sb.append(<span class="string">"\n Fuel Type: "</span>);</span><br><span class="line">        sb.append(fuelType);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>某个汽车制造厂定义了一个 <code>CarBuilder</code> 接口，要求员工们遵照这样的方法去生产一辆汽车。</p>
<details><summary>CarBuilder.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.builderpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CarBuilder</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBodyStyle</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPower</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildEngine</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBreaks</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildSeats</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildWindows</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildFuelType</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">getCar</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>有一个车间是生产运动汽车的，他们这样子去实现这个接口。（其他车间是一样的道理，此处略去）</p>
<details><summary>SportsCarBuilder.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.builderpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SportsCarBuilder</span> <span class="keyword">implements</span> <span class="title">CarBuilder</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Car car = <span class="keyword">new</span> Car(<span class="string">"SPORTS"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBodyStyle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        car.setBodyStyle(<span class="string">"External dimensions: overall length (inches): 192.3,"</span> +</span><br><span class="line">                <span class="string">" overall width (inches): 75.5, overall height (inches): 54.2, wheelbase (inches): 112.3,"</span> +</span><br><span class="line">                <span class="string">" front track (inches): 63.7, rear track (inches): 64.1 and curb to curb turning circle (feet): 37.7"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPower</span><span class="params">()</span></span>&#123;</span><br><span class="line">        car.setPower(<span class="string">"323 hp @ 6,800 rpm; 278 ft lb of torque @ 4,800 rpm"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        car.setEngine(<span class="string">"3.6L V 6 DOHC and variable valve timing"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBreaks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        car.setBreaks(<span class="string">"Four-wheel disc brakes: two ventilated. Electronic brake distribution. StabiliTrak stability control"</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildSeats</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        car.setSeats(<span class="string">"Driver sports front seat with one power adjustments manual height, front passenger seat sports front seat with one power adjustments"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildWindows</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        car.setWindows(<span class="string">"Front windows with one-touch on two windows"</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildFuelType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        car.setFuelType(<span class="string">"Gasoline 17 MPG city, 28 MPG highway, 20 MPG combined and 380 mi. range"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">getCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>运用<em>外观模式</em>封装操作、运用<em>策略模式</em>根据传入的<code>carBuilder</code>不同，车间的全共工作人员 <code>Director</code> 共同配合让这个车间工作起来组装汽车。</p>
<details><summary>CarDirector.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.builderpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarDirector</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> CarBuilder carBuilder;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CarDirector</span><span class="params">(CarBuilder carBuilder)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.carBuilder = carBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">        carBuilder.buildBodyStyle();</span><br><span class="line">        carBuilder.buildPower();</span><br><span class="line">        carBuilder.buildEngine();</span><br><span class="line">        carBuilder.buildBreaks();</span><br><span class="line">        carBuilder.buildSeats();</span><br><span class="line">        carBuilder.buildWindows();</span><br><span class="line">        carBuilder.buildFuelType();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line">CarBuilder carBuilder = <span class="keyword">new</span> SportsCarBuilder();</span><br><span class="line"><span class="comment">// aggragation</span></span><br><span class="line">CarDirector director = <span class="keyword">new</span> CarDirector(carBuilder);</span><br><span class="line"><span class="comment">// director 内部会执行一 carBuilder 的系列指令</span></span><br><span class="line"><span class="comment">// 此处用到了外观模式</span></span><br><span class="line">director.build();</span><br><span class="line">car = carBuilder.getCar();</span><br><span class="line">System.out.println(car);</span><br></pre></td></tr></table></figure>
<h1 id="structural-patterns-结构型模式"><a class="markdownIt-Anchor" href="#structural-patterns-结构型模式"></a> Structural patterns | 结构型模式</h1>
<p>利用现有类和对象组成更大的数据结构。比如将两个或更多的类进行集成产生更复杂的类，同时还有可能增加新的功能。</p>
<h2 id="bridge-design-pattern-桥接模式"><a class="markdownIt-Anchor" href="#bridge-design-pattern-桥接模式"></a> Bridge design pattern | 桥接模式</h2>
<ul>
<li>使用 3 种笔锋和 4 颜料组成 12 种不同的毛笔。</li>
<li>Chrome 浏览器将操作系统与图像格式两个维度分离，同时支持 4 个操作系统的 5 种图像。</li>
</ul>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="bridge-uml.png">
<ul>
<li><code>Abstraction</code> <a href="../../../../2018/06/05/java-UML/#%E5%9B%9B%E7%A7%8D-Delegation-%E8%BE%A8%E6%9E%90">aggregate</a> <code>Implementor</code>，它们之间的联系称为“桥”。</li>
<li><code>RefinedAbstration</code> 实现 <code>Abstraction</code>。</li>
<li><code>ConcreteImplementor</code> 实现 <code>Implementor</code>。</li>
</ul>
<p>桥接模式起到解耦（decouple）作用，实现与接口不再永久相关联，修改 <code>ConcreteImplementor</code> 之后客户端仍可使用 <code>Implementor</code> 接口。</p>
<p><strong>代码：</strong></p>
<p>汽车有齿轮锁定（gear locking）和中央锁定（central locking）两种类型，而且还有不同的牌子。表现为 <code>product</code> 和 <code>carType</code>。</p>
<details><summary>Car.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.bridgepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Product product;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String carType;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(Product product,String carType)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">        <span class="keyword">this</span>.carType = carType;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">assemble</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">produceProduct</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printDetails</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Car: "</span>+carType+<span class="string">", Product:"</span>+product.productName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<img src="bridge-car-uml.png">
<p>将 <code>product</code> 解耦出来，定义接口 <code>Product</code>，在其基础上进行实现。</p>
<details><summary>Product.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.bridgepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">productName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>GearLocking.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.bridgepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GearLocking</span> <span class="keyword">implements</span> <span class="title">Product</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String productName;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GearLocking</span><span class="params">(String productName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productName = productName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">productName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Producing Gear Locking System"</span>);</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>客户端可以使用各种组合得到想要的汽车。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Product product = <span class="keyword">new</span> CentralLocking(<span class="string">"Central Locking System"</span>);</span><br><span class="line">Product product2 = <span class="keyword">new</span> GearLocking(<span class="string">"Gear Locking System"</span>);</span><br><span class="line"><span class="comment">// 大轮子、中央锁定</span></span><br><span class="line">Car car = <span class="keyword">new</span> BigWheel(product , <span class="string">"BigWheel xz model"</span>);</span><br><span class="line">car.produceProduct();</span><br><span class="line">car.assemble();</span><br><span class="line">car.printDetails();</span><br><span class="line"></span><br><span class="line">System.out.println();</span><br><span class="line"><span class="comment">// 大轮子、齿轮锁定</span></span><br><span class="line">car = <span class="keyword">new</span> BigWheel(product2 , <span class="string">"BigWheel xz model"</span>);</span><br><span class="line">car.produceProduct();</span><br><span class="line">car.assemble();</span><br><span class="line">car.printDetails();</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong></p>
<p>类的组成部分较多的时候，将一些内部变量 aggregate 出去，能够减少许多压力。结构关系非常明显。</p>
<table>
<thead>
<tr>
<th style="text-align:center">桥接模式</th>
<th style="text-align:center">策略模式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="bridge.png" height="150"></td>
<td style="text-align:center"><img src="strategy.png" height="150"></td>
</tr>
<tr>
<td style="text-align:center">设备抽象接口可以由电脑、手机等实现，在运行时为设备拥有者设定不同的设备，会建立 delegation。</td>
<td style="text-align:center">使用螺丝刀时将其取出，不用时没有任何联系。注重算法，不强调结构上的联系。</td>
</tr>
</tbody>
</table>
<h2 id="proxy-design-pattern-代理模式"><a class="markdownIt-Anchor" href="#proxy-design-pattern-代理模式"></a> Proxy design pattern | 代理模式</h2>
<ul>
<li>在国内买不到 Google Pixel 手机，你可以第三方零售商（代购）帮你去国外买一个，你再向他买。</li>
<li>大家平时所用的访问 Google 的正向代理。</li>
</ul>
<p>主要有三类：</p>
<ol>
<li><em>远程代理(Remote Proxy)</em>：为一个位于<strong>不同的地址空间的对象</strong>提供一个<strong>本地的代理对象</strong>，这个不同的地址空间可以是在同一台主机中，也可是在另一台主机中，远程代理又称为大使(Ambassador)。</li>
<li><em>虚拟代理(Virtual Proxy)</em>：如果需要创建一个<strong>资源消耗较大的对象</strong>，先创建一个消耗相对较小的对象来表示，真实对象<strong>只在需要时才会被真正创建</strong>。</li>
<li><em>保护代理(Protect Proxy)</em>：<strong>控制</strong>对一个对象的访问，可以给不同的用户提供不同级别的使用权限。</li>
</ol>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="proxy-uml.png">
<p>访问过程：client -&gt; Proxy -&gt; RealSubject。</p>
<p><strong>代码：</strong></p>
<p>有一个远程的报告生成器接口，继承了 Java 自带的<code>Remote</code> 而变成被代理者。</p>
<blockquote>
<p>The Remote interface serves to identify interfaces whose methods may be invoked from a non-local virtual machine. Any object that is a remote object must directly or indirectly implement this interface. Only those methods specified in a “remote interface”, an interface that extends java.rmi.Remote is available remotely.</p>
</blockquote>
<details><summary>ReportGenerator.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.proxypattern.remoteproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ReportGenerator</span> <span class="keyword">extends</span> <span class="title">Remote</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateDailyReport</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>它也在远程被实现了。</p>
<details><summary>ReportGeneratorImpl.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.proxypattern.remoteproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.UnicastRemoteObject;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReportGeneratorImpl</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">ReportGenerator</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3107413009881629428L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">ReportGeneratorImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateDailyReport</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">"********************Location X Daily Report********************"</span>);</span><br><span class="line">        sb.append(<span class="string">"\n Location ID: 012"</span>);</span><br><span class="line">        sb.append(<span class="string">"\n Today's Date: "</span>+<span class="keyword">new</span> Date());</span><br><span class="line">        sb.append(<span class="string">"\n Total Pizza Sell: 112"</span>);</span><br><span class="line">        sb.append(<span class="string">"\n Total Sale: $2534"</span>);</span><br><span class="line">        sb.append(<span class="string">"\n Net Profit: $1985"</span>);</span><br><span class="line">        sb.append(<span class="string">"\n ***************************************************************"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ReportGenerator reportGenerator = <span class="keyword">new</span> ReportGeneratorImpl();</span><br><span class="line">      <span class="comment">// 将 reportGenerator 绑定到 PizzaCoRemoteGenerator</span></span><br><span class="line">            Naming.rebind(<span class="string">"PizzaCoRemoteGenerator"</span>, reportGenerator);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>客户端无法直接用远程接口，而代理则可以使用，同时把相同的功能提供给客户端，下面是代理的一段代码。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取本机（127.0.0.1）的 PizzaCoRemoteGenerator</span></span><br><span class="line"><span class="comment">// 如果不是本机，代理的作用体现更加明显</span></span><br><span class="line">ReportGenerator reportGenerator = (ReportGenerator)Naming.lookup(<span class="string">"rmi://127.0.0.1/PizzaCoRemoteGenerator"</span>);</span><br><span class="line">System.out.println(reportGenerator.generateDailyReport());</span><br></pre></td></tr></table></figure>
<p>这是最简单的<strong>远程代理</strong>，当然可以在代理那儿对用户可以进行的操作做一些限制，这就成为了<strong>保护代理</strong>。</p>
<h2 id="composite-组合模式"><a class="markdownIt-Anchor" href="#composite-组合模式"></a> Composite | 组合模式</h2>
<p>树形结构随处可见，比如操作系统的文件组织结构、软件菜单、公司部门架构等等。</p>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="composite-uml.png">
<p><code>Composite</code> <a href="../../../../2018/06/05/java-UML/#%E5%9B%9B%E7%A7%8D-Delegation-%E8%BE%A8%E6%9E%90">aggregate</a> 了许多 <code>Component</code>，这些组件的具体实现可以是叶子 <code>Leaf</code>，也可以是 <code>Composite</code> 本身。</p>
<img src="composite-and-leaf.png">
<p><strong>代码：</strong></p>
<p>不管是叶子，还是中间节点，都属于同一种接口或抽象类。在 html 语言中，不管是可扩展的父级标签，还是终止标签，都要继承基础的 html 标签 <code>HtmlTag</code>。</p>
<details><summary>HtmlTag.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.compositepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlTag</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getTagName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setStartTag</span><span class="params">(String tag)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setEndTag</span><span class="params">(String tag)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTagBody</span><span class="params">(String tagBody)</span></span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Current operation is not support for this object"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChildTag</span><span class="params">(HtmlTag htmlTag)</span></span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Current operation is not support for this object"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeChildTag</span><span class="params">(HtmlTag htmlTag)</span></span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Current operation is not support for this object"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;HtmlTag&gt;getChildren()&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Current operation is not support for this object"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">generateHtml</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>叶子节点只需实现抽象方法，对于 <code>addChildTag</code> 这样的操作不必实现。</p>
<details><summary>HtmlElement.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.compositepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlElement</span> <span class="keyword">extends</span> <span class="title">HtmlTag</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String tagName;</span><br><span class="line">    <span class="keyword">private</span> String startTag; </span><br><span class="line">    <span class="keyword">private</span> String endTag;</span><br><span class="line">    <span class="keyword">private</span> String tagBody;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HtmlElement</span><span class="params">(String tagName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tagName = tagName;</span><br><span class="line">        <span class="keyword">this</span>.tagBody = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">this</span>.startTag = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">this</span>.endTag = <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTagName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tagName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStartTag</span><span class="params">(String tag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.startTag = tag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEndTag</span><span class="params">(String tag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.endTag = tag;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTagBody</span><span class="params">(String tagBody)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tagBody = tagBody;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateHtml</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(startTag+<span class="string">""</span>+tagBody+<span class="string">""</span>+endTag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>父级标签可能在中间继续插入标签，需要多实现一些方法支持递归插入 <code>HtmlTag</code>。</p>
<details><summary>HtmlParentElement.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.compositepattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlParentElement</span> <span class="keyword">extends</span> <span class="title">HtmlTag</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String tagName;</span><br><span class="line">    <span class="keyword">private</span> String startTag; </span><br><span class="line">    <span class="keyword">private</span> String endTag;</span><br><span class="line">    <span class="keyword">private</span> List&lt;HtmlTag&gt;childrenTag;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HtmlParentElement</span><span class="params">(String tagName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tagName = tagName;</span><br><span class="line">        <span class="keyword">this</span>.startTag = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">this</span>.endTag = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">this</span>.childrenTag = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTagName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tagName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStartTag</span><span class="params">(String tag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.startTag = tag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEndTag</span><span class="params">(String tag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.endTag = tag;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChildTag</span><span class="params">(HtmlTag htmlTag)</span></span>&#123;</span><br><span class="line">        childrenTag.add(htmlTag);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeChildTag</span><span class="params">(HtmlTag htmlTag)</span></span>&#123;</span><br><span class="line">        childrenTag.remove(htmlTag);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;HtmlTag&gt;getChildren()&#123;</span><br><span class="line">        <span class="keyword">return</span> childrenTag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateHtml</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(startTag);</span><br><span class="line">        <span class="keyword">for</span>(HtmlTag tag : childrenTag)&#123;</span><br><span class="line">            tag.generateHtml();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(endTag);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>客户端可以自己构造想要的 html 树。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HtmlTag parentTag = <span class="keyword">new</span> HtmlParentElement(<span class="string">"&lt;html&gt;"</span>);</span><br><span class="line">parentTag.setStartTag(<span class="string">"&lt;html&gt;"</span>);</span><br><span class="line">parentTag.setEndTag(<span class="string">"&lt;/html&gt;"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// body 定义</span></span><br><span class="line">HtmlTag p1 = <span class="keyword">new</span> HtmlParentElement(<span class="string">"&lt;body&gt;"</span>);</span><br><span class="line">p1.setStartTag(<span class="string">"&lt;body&gt;"</span>);</span><br><span class="line">p1.setEndTag(<span class="string">"&lt;/body&gt;"</span>);</span><br><span class="line"></span><br><span class="line">parentTag.addChildTag(p1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第 1 自然段</span></span><br><span class="line">HtmlTag child1 = <span class="keyword">new</span> HtmlElement(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setStartTag(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setEndTag(<span class="string">"&lt;/p&gt;"</span>);</span><br><span class="line">child1.setTagBody(<span class="string">"Testing html tag library"</span>);</span><br><span class="line">p1.addChildTag(child1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第 2 自然段</span></span><br><span class="line">child1 = <span class="keyword">new</span> HtmlElement(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setStartTag(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setEndTag(<span class="string">"&lt;/p&gt;"</span>);</span><br><span class="line">child1.setTagBody(<span class="string">"Paragraph 2"</span>);</span><br><span class="line">p1.addChildTag(child1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成 html</span></span><br><span class="line">parentTag.generateHtml();</span><br></pre></td></tr></table></figure>
<h1 id="behavioral-patterns-行为型模式"><a class="markdownIt-Anchor" href="#behavioral-patterns-行为型模式"></a> Behavioral patterns | 行为型模式</h1>
<p>与<strong>算法</strong>有关，与对象之间的任务分配相关。这种模式同时表示了类和对象之间的一种联系，能够让你在运行时做一些决策，避免了很多头疼的问题。</p>
<h2 id="observer-design-pattern-观察者模式"><a class="markdownIt-Anchor" href="#observer-design-pattern-观察者模式"></a> Observer design pattern | 观察者模式</h2>
<ul>
<li>在交通路口，每辆车都观察者红绿路灯，一旦路等状态改变，车也要做出一些改变。</li>
<li>在 GitHub 中 Watch 某个项目后，你就成为了观察者，每次项目有动态，你都会收到邮件，你可以选择忽视，或者去做一些 hack。</li>
</ul>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="observer-uml.png">
<p><code>Observer</code> 一直关注着 <code>Subject</code> 的动态（<code>Subject</code> 给 <code>Observer</code> 发信息），<code>ConcreteObserver</code> 需要有一个 <code>ConcreteSubject</code> 来接收消息。</p>
<p><strong>代码：</strong></p>
<img src="observer-impl-uml.png">
<p><code>Subject</code> 可以增加/删除观察者，并且通知他们最新进展。（容易联想到 Youtube 里面的 subscribe，这个 <code>Subject</code> 相当于还未实现的一个 Youtuber，可以接受别人的订阅）</p>
<details><summary>Subject.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.observerpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 使用了 Observer    </span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unSubscribeObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">subjectDetails</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><code>Observer</code> 可以订阅、取消订阅、收到订阅之后进行操作。</p>
<details><summary>Observer.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.observerpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String desc)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unSubscribe</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>订阅的具体操作是让 <code>Subject</code> 知道自己属于订阅者的一部分。</p>
<details><summary>SMSUsers.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.observerpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SMSUsers</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Subject subject;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line">    <span class="keyword">private</span> String userInfo;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SMSUsers</span><span class="params">(Subject subject,String userInfo)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(subject==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"No Publisher found."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.subject = subject;</span><br><span class="line">        <span class="keyword">this</span>.userInfo = userInfo;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String desc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"["</span>+userInfo+<span class="string">"]: "</span>+desc);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Subscribing "</span>+userInfo+<span class="string">" to "</span>+subject.subjectDetails()+<span class="string">" ..."</span>);</span><br><span class="line">    <span class="comment">// 加入到订阅者中</span></span><br><span class="line">        <span class="keyword">this</span>.subject.subscribeObserver(<span class="keyword">this</span>);</span><br><span class="line">        System.out.println(<span class="string">"Subscribed successfully."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unSubscribe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Unsubscribing "</span>+userInfo+<span class="string">" to "</span>+subject.subjectDetails()+<span class="string">" ..."</span>);</span><br><span class="line">        <span class="keyword">this</span>.subject.unSubscribeObserver(<span class="keyword">this</span>);</span><br><span class="line">        System.out.println(<span class="string">"Unsubscribed successfully."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>被订阅者每次给用户发消息都会更新他们的状态。</p>
<details><summary>CommentaryObject.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.observerpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentaryObject</span> <span class="keyword">implements</span> <span class="title">Subject</span>,<span class="title">Commentary</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Observer&gt;observers;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String subjectDetails;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommentaryObject</span><span class="params">(List&lt;Observer&gt;observers,String subjectDetails)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.observers = observers;</span><br><span class="line">        <span class="keyword">this</span>.subjectDetails = subjectDetails;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unSubscribeObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = observers.indexOf(observer);</span><br><span class="line">        observers.remove(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="keyword">for</span>(Observer observer : observers)&#123;</span><br><span class="line">      <span class="comment">// 用我的 desc 通知你</span></span><br><span class="line">      observer.update(desc);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDesc</span><span class="params">(String desc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    <span class="comment">// 每次都通知所有订阅者</span></span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">subjectDetails</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> subjectDetails;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>但是你会觉得这样太麻烦了，继承 Java 自带的 <code>Observable</code> 可以不用实现 <code>subscribeObserver</code>、<code>unSubscribeObserver</code> 和 <code>notifyObservers</code>。</p>
<details><summary>CommentaryObjectObservable.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.observerpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Observable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentaryObjectObservable</span> <span class="keyword">extends</span> <span class="title">Observable</span> <span class="keyword">implements</span> <span class="title">Commentary</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String subjectDetails;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommentaryObjectObservable</span><span class="params">(String subjectDetails)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subjectDetails = subjectDetails;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDesc</span><span class="params">(String desc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">        setChanged();</span><br><span class="line">    <span class="comment">// 还要记得调用 notifyObservers(desc);</span></span><br><span class="line">        notifyObservers(desc);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">subjectDetails</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> subjectDetails;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 有一场足球比赛</span></span><br><span class="line">Subject subject = <span class="keyword">new</span> CommentaryObject(<span class="keyword">new</span> ArrayList&lt;Observer&gt;(), <span class="string">"Soccer Match [2014AUG24]"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用了 Subject</span></span><br><span class="line"><span class="comment">// 1 号观察者只能订阅 subject</span></span><br><span class="line">Observer observer1 = <span class="keyword">new</span> SMSUsers(subject, <span class="string">"Adam Warner [New York]"</span>);</span><br><span class="line"><span class="comment">// 1 号观察者开始订阅</span></span><br><span class="line">observer1.subscribe();</span><br><span class="line"></span><br><span class="line">System.out.println();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 号观察者只能订阅 subject</span></span><br><span class="line">Observer observer2 = <span class="keyword">new</span> SMSUsers(subject, <span class="string">"Tim Ronney [London]"</span>);</span><br><span class="line"><span class="comment">// 2 号观察者开始订阅</span></span><br><span class="line">observer2.subscribe();</span><br><span class="line"></span><br><span class="line">Commentary cObject = ((Commentary)subject);</span><br><span class="line">cObject.setDesc(<span class="string">"Welcome to live Soccer match"</span>);</span><br><span class="line">cObject.setDesc(<span class="string">"Current score 0-0"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 号观察者取消订阅</span></span><br><span class="line">observer2.unSubscribe();</span><br></pre></td></tr></table></figure>
<h2 id="visitor-design-pattern-访问者模式"><a class="markdownIt-Anchor" href="#visitor-design-pattern-访问者模式"></a> Visitor design pattern | 访问者模式</h2>
<ul>
<li>有一张药品清单，你需要在不同分别取药。</li>
<li>公司有很多员工，有全职或兼职，需要由人事部计算工作时间、财务部计算工资。</li>
</ul>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="visitor-uml.png">
<p><code>Visitor</code> 可以访问 A、B。<code>Element</code> 中定义接受操作 <code>accept</code>，接受来自某个具体的访问者的访问。</p>
<p><strong>代码：</strong></p>
<p>基于组合模式中的 <code>HtmlTag</code>，设计一种可以修改其 class 定义的 <code>Visitor</code>。唯一的区别是 <code>HtmlTag</code> 新增了 <code>accept()</code> 方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlTag</span> <span class="keyword">implements</span> <span class="title">Element</span></span>&#123;</span><br></pre></td></tr></table></figure>
<details><summary>HtmlParentElement.java 中修改的部分</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</details>
<details><summary>CssClassVisitor.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.visitorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CssClassVisitor</span> <span class="keyword">implements</span> <span class="title">Visitor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(HtmlElement element)</span> </span>&#123;</span><br><span class="line">        element.setStartTag(element.getStartTag().replace(<span class="string">"&gt;"</span>, <span class="string">" class='visitor'&gt;"</span>));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(HtmlParentElement parentElement)</span> </span>&#123;</span><br><span class="line">        parentElement.setStartTag(parentElement.getStartTag().replace(<span class="string">"&gt;"</span>, <span class="string">" class='visitor'&gt;"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(<span class="string">"Before visitor......... \n"</span>);</span><br><span class="line"><span class="comment">// 1. 创建一份 html</span></span><br><span class="line">HtmlTag parentTag = <span class="keyword">new</span> HtmlParentElement(<span class="string">"&lt;html&gt;"</span>);</span><br><span class="line">parentTag.setStartTag(<span class="string">"&lt;html&gt;"</span>);</span><br><span class="line">parentTag.setEndTag(<span class="string">"&lt;/html&gt;"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.1 加入 body</span></span><br><span class="line">HtmlTag p1 = <span class="keyword">new</span> HtmlParentElement(<span class="string">"&lt;body&gt;"</span>);</span><br><span class="line">p1.setStartTag(<span class="string">"&lt;body&gt;"</span>);</span><br><span class="line">p1.setEndTag(<span class="string">"&lt;/body&gt;"</span>);</span><br><span class="line"></span><br><span class="line">parentTag.addChildTag(p1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.2 加入第 1 段</span></span><br><span class="line">HtmlTag child1 = <span class="keyword">new</span> HtmlElement(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setStartTag(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setEndTag(<span class="string">"&lt;/p&gt;"</span>);</span><br><span class="line">child1.setTagBody(<span class="string">"Testing html tag library"</span>);</span><br><span class="line">p1.addChildTag(child1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.3 加入第 2 段</span></span><br><span class="line">child1 = <span class="keyword">new</span> HtmlElement(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setStartTag(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setEndTag(<span class="string">"&lt;/p&gt;"</span>);</span><br><span class="line">child1.setTagBody(<span class="string">"Paragraph 2"</span>);</span><br><span class="line">p1.addChildTag(child1);</span><br><span class="line"></span><br><span class="line">parentTag.generateHtml();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"\nAfter visitor....... \n"</span>);</span><br><span class="line"><span class="comment">// 2. 创建一份 html，之后接受访问并修改</span></span><br><span class="line">Visitor cssClass = <span class="keyword">new</span> CssClassVisitor();</span><br><span class="line">Visitor style = <span class="keyword">new</span> StyleVisitor();</span><br><span class="line"></span><br><span class="line">parentTag = <span class="keyword">new</span> HtmlParentElement(<span class="string">"&lt;html&gt;"</span>);</span><br><span class="line">parentTag.setStartTag(<span class="string">"&lt;html&gt;"</span>);</span><br><span class="line">parentTag.setEndTag(<span class="string">"&lt;/html&gt;"</span>);</span><br><span class="line"><span class="comment">// 2.1 parentTag 接受 style 的访问</span></span><br><span class="line">parentTag.accept(style);</span><br><span class="line"><span class="comment">// 2.2 parentTag 接受 cssClass 的访问</span></span><br><span class="line">parentTag.accept(cssClass);</span><br><span class="line"></span><br><span class="line">p1 = <span class="keyword">new</span> HtmlParentElement(<span class="string">"&lt;body&gt;"</span>);</span><br><span class="line">p1.setStartTag(<span class="string">"&lt;body&gt;"</span>);</span><br><span class="line">p1.setEndTag(<span class="string">"&lt;/body&gt;"</span>);</span><br><span class="line">p1.accept(style);</span><br><span class="line">p1.accept(cssClass);</span><br><span class="line"></span><br><span class="line">parentTag.addChildTag(p1);</span><br><span class="line"></span><br><span class="line">child1 = <span class="keyword">new</span> HtmlElement(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setStartTag(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setEndTag(<span class="string">"&lt;/p&gt;"</span>);</span><br><span class="line">child1.setTagBody(<span class="string">"Testing html tag library"</span>);</span><br><span class="line">child1.accept(style);</span><br><span class="line">child1.accept(cssClass);</span><br><span class="line"></span><br><span class="line">p1.addChildTag(child1);</span><br><span class="line"></span><br><span class="line">child1 = <span class="keyword">new</span> HtmlElement(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setStartTag(<span class="string">"&lt;p&gt;"</span>);</span><br><span class="line">child1.setEndTag(<span class="string">"&lt;/p&gt;"</span>);</span><br><span class="line">child1.setTagBody(<span class="string">"Paragraph 2"</span>);</span><br><span class="line">child1.accept(style);</span><br><span class="line">child1.accept(cssClass);</span><br><span class="line"></span><br><span class="line">p1.addChildTag(child1);</span><br><span class="line"></span><br><span class="line">parentTag.generateHtml();</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong></p>
<p>可以<strong>动态地</strong>使用不同的 visitor，而无需修改被 visit 的类的实现。可以将某些操作分离开来，强调算法，也是一种行为型模式。</p>
<table>
<thead>
<tr>
<th style="text-align:center">访问者模式</th>
<th style="text-align:center">迭代器模式</th>
<th style="text-align:center">策略模式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">客户端可以灵活地选择 visitor，对被访问者进行不同的操作</td>
<td style="text-align:center">也是行为型模式，但是只允许客户端进行迭代操作</td>
<td style="text-align:center">ADT 内部自己有不同的选择策略，和访问者模式 ADT 被动的被访问不同</td>
</tr>
</tbody>
</table>
<h2 id="mediator-design-pattern-中介者模式"><a class="markdownIt-Anchor" href="#mediator-design-pattern-中介者模式"></a> Mediator design pattern | 中介者模式</h2>
<ul>
<li>聊天群方便告知所有人一条信息</li>
<li>软件中错综复杂的逻辑关系需要更简单的管理方法</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">未使用 mediator</th>
<th style="text-align:center">使用 mediator</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="before-mediator.png"></td>
<td style="text-align:center"><img src="after-mediator.png"></td>
</tr>
</tbody>
</table>
<p>中介起到了转发消息的功能。</p>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="mediator-uml.png">
<p><code>Colleague</code> 接口通过 <code>Mediator</code> 传送消息。<code>Mediator</code> 的实现 <code>ConcreteMediator</code> 会告知所有的 <code>ConcreteColleague</code>。</p>
<p><strong>代码：</strong></p>
<p>在一台机器中，各组件通过中介相互通信。</p>
<details><summary>MachineMediator.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.mediatorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MachineMediator</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closed</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkTemperature</span><span class="params">(<span class="keyword">int</span> temp)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><code>Machine</code> 就实现了 <code>Colleague</code>，能够 <code>setMediator</code>。</p>
<details><summary>Machine.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.mediatorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Machine</span> <span class="keyword">implements</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MachineMediator mediator;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMediator</span><span class="params">(MachineMediator mediator)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mediator.open();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mediator.wash();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><code>Button</code> 也实现了 <code>Colleague</code>。</p>
<details><summary>Button.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.mediatorpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">implements</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> MachineMediator mediator;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMediator</span><span class="params">(MachineMediator mediator)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">press</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Button pressed."</span>);</span><br><span class="line">    <span class="comment">// 利用中介通知其他组件</span></span><br><span class="line">        mediator.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>在 <code>Machine</code> 进行 <code>wash</code> 操作时，中介者会告知所有相关的组件，这就是中介所起的作用。</p>
<details><summary>CottonMediator.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.mediatorpattern;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CottonMediator</span> <span class="keyword">implements</span> <span class="title">MachineMediator</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Machine machine;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Heater heater;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Motor motor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sensor sensor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SoilRemoval soilRemoval;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Valve valve;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CottonMediator</span><span class="params">(Machine machine,Heater heater,Motor motor,Sensor sensor,SoilRemoval soilRemoval,Valve valve)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.machine = machine;</span><br><span class="line">        <span class="keyword">this</span>.heater = heater;</span><br><span class="line">        <span class="keyword">this</span>.motor = motor;</span><br><span class="line">        <span class="keyword">this</span>.sensor = sensor;</span><br><span class="line">        <span class="keyword">this</span>.soilRemoval = soilRemoval;</span><br><span class="line">        <span class="keyword">this</span>.valve = valve;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">".........................Setting up for COTTON program........................."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        machine.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        motor.startMotor();</span><br><span class="line">        motor.rotateDrum(<span class="number">700</span>);</span><br><span class="line">        System.out.println(<span class="string">"Adding detergent"</span>);</span><br><span class="line">        soilRemoval.low();</span><br><span class="line">        System.out.println(<span class="string">"Adding softener"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        valve.open();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        valve.closed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        heater.on(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        heater.off();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkTemperature</span><span class="params">(<span class="keyword">int</span> temp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sensor.checkTemperature(temp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>客户端可能会用上面的 <code>CottonMediator</code> 做中介者，在 <code>Button</code> 中使用这个中介者。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Sensor sensor = <span class="keyword">new</span> Sensor();</span><br><span class="line">SoilRemoval soilRemoval = <span class="keyword">new</span> SoilRemoval();</span><br><span class="line">Motor motor = <span class="keyword">new</span> Motor();</span><br><span class="line">Machine machine = <span class="keyword">new</span> Machine();</span><br><span class="line">Heater heater = <span class="keyword">new</span> Heater();</span><br><span class="line">Valve valve = <span class="keyword">new</span> Valve();</span><br><span class="line">Button button = <span class="keyword">new</span> Button();</span><br><span class="line"><span class="comment">// 新建一个中介者，MachineMediator -&gt; ConcreteColleague</span></span><br><span class="line">MachineMediator mediator = <span class="keyword">new</span> CottonMediator(machine, heater, motor, sensor, soilRemoval, valve);</span><br><span class="line"><span class="comment">// 与这个中介者关联，Colleague -&gt; Mediator</span></span><br><span class="line">button.setMediator(mediator);</span><br><span class="line">machine.setMediator(mediator);</span><br><span class="line">heater.setMediator(mediator);</span><br><span class="line">valve.setMediator(mediator);</span><br><span class="line"></span><br><span class="line">button.press();</span><br><span class="line"><span class="comment">// 1. 按键被按下</span></span><br><span class="line"><span class="comment">//    调用中介者的 `start()` 通知所有相关组件进行操作</span></span><br><span class="line"><span class="comment">// 2. machine 收到 start 信息</span></span><br><span class="line"><span class="comment">//    machine 启动，调用中介者的 `open()` 通知相关组件进行操作</span></span><br><span class="line"><span class="comment">// 3. valve 收到 open 信息</span></span><br><span class="line">  ...</span><br><span class="line"><span class="comment">// 直到启动完成</span></span><br></pre></td></tr></table></figure>
<details><summary>输出结果</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Setting up <span class="keyword">for</span> COTTON program</span><br><span class="line">Button pressed.</span><br><span class="line">Valve is opened...</span><br><span class="line">Filling water...</span><br><span class="line">Valve is closed...</span><br><span class="line">Heater is on...</span><br><span class="line">Temperature reached <span class="number">40</span> C</span><br><span class="line">Temperature is set to <span class="number">40</span></span><br><span class="line">Heater is off...</span><br><span class="line">Start motor...</span><br><span class="line">Rotating drum at <span class="number">700</span> rpm.</span><br><span class="line">Adding detergent</span><br><span class="line">Setting Soil Removal to low</span><br><span class="line">Adding softener</span><br></pre></td></tr></table></figure>
</details>
<p><strong>总结：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">观察者模式</th>
<th style="text-align:center">中介者模式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">自己（Youtuber）来广播，其他对象接收</td>
<td style="text-align:center">第三方中介负责广播</td>
</tr>
</tbody>
</table>
<h2 id="command-design-pattern-命令模式"><a class="markdownIt-Anchor" href="#command-design-pattern-命令模式"></a> Command design pattern | 命令模式</h2>
<ul>
<li>开关通过电线请求电灯打开。</li>
<li>软件中一个按钮请求执行某个操作。</li>
</ul>
<blockquote>
<p>很多时候，希望能够以一种松耦合的方式来设计软件，使得请求发送者与请求接收者能够消除彼此之间的耦合，让对象之间的调用关系更加灵活，可以灵活地指定请求接收者以及被请求的操作。命令模式为此类问题提供了一个较为完美的解决方案。</p>
</blockquote>
<blockquote>
<p>将一个请求封装为一个对象，从而让我们可用不同的请求对客户进行参数化；对请求排队或者记录请求日志，以及支持可撤销的操作。命令模式是一种对象行为型模式，其别名为动作(Action)模式或事务(Transaction)模式。</p>
</blockquote>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="command-uml.png">
<p><code>ConcreteCommand</code> 调用 <code>Receiver</code> 实现 <code>execute</code>，将 <code>Receiver</code> 和 <code>Invoker</code> 联系起来。</p>
<p><strong>代码：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">Client</th>
<th style="text-align:center">Receiver</th>
<th style="text-align:center">Invoker</th>
<th style="text-align:center">Command</th>
<th style="text-align:center">ConcreteCommand</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">客户端</td>
<td style="text-align:center">Email</td>
<td style="text-align:center">ThreadPool</td>
<td style="text-align:center">Job</td>
<td style="text-align:center">EmailJob</td>
</tr>
</tbody>
</table>
<p>收到命令后，由通用的 <code>Job</code> 执行。</p>
<details><summary>Job.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.commandpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>比如 <code>EmailJob</code>，在内部 aggregate 了一个 <code>Email</code>，可以收发邮件。</p>
<details><summary>EmailJob.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.commandpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailJob</span> <span class="keyword">implements</span> <span class="title">Job</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Email email;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(Email email)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Job ID: "</span>+Thread.currentThread().getId()+<span class="string">" executing email jobs."</span>);</span><br><span class="line">        <span class="keyword">if</span>(email!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            email.sendEmail();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><code>Email</code> 的内容。</p>
<details><summary>Email.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.commandpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Email</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Sending email......."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>所有的 <code>Job</code> 都放入到同一个 <code>ThreadPool</code> 中，排队执行这些命令。</p>
<details><summary>ThreadPool.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.commandpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;Job&gt; jobQueue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Thread[] jobThreads;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> shutdown;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPool</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        jobQueue = <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;();</span><br><span class="line">        jobThreads = <span class="keyword">new</span> Thread[n];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="comment">// 使用 Worker 来 run</span></span><br><span class="line">            jobThreads[i] = <span class="keyword">new</span> Worker(<span class="string">"Pool Thread "</span> + i);</span><br><span class="line">            jobThreads[i].start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addJob</span><span class="params">(Job r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jobQueue.put(r);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdownPool</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">// 队列空的时候才能停下</span></span><br><span class="line">        <span class="keyword">while</span> (!jobQueue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        shutdown = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (Thread workerThread : jobThreads) &#123;</span><br><span class="line">            workerThread.interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Worker</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (!shutdown) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">// 总是取队列中第一个元素来run</span></span><br><span class="line">                    Job r = jobQueue.take();</span><br><span class="line">                    r.run();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>只要客户端是在使用这个线程池，每个任务一定执行的相应的操作，比如 <code>emailJob</code> 一定是发送邮件，客户端无需知道细节。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ThreadPool pool = <span class="keyword">new</span> ThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">Email email = <span class="keyword">null</span>;</span><br><span class="line">EmailJob  emailJob = <span class="keyword">new</span> EmailJob();</span><br><span class="line"></span><br><span class="line">Sms sms = <span class="keyword">null</span>;</span><br><span class="line">SmsJob smsJob = <span class="keyword">new</span> SmsJob();</span><br><span class="line"></span><br><span class="line">FileIO fileIO = <span class="keyword">null</span>;</span><br><span class="line">FileIOJob fileIOJob = <span class="keyword">new</span> FileIOJob();</span><br><span class="line"></span><br><span class="line">Logging logging = <span class="keyword">null</span>;;</span><br><span class="line">LoggingJob logJob = <span class="keyword">new</span> LoggingJob();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环 5 次</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    email = <span class="keyword">new</span> Email();</span><br><span class="line">  <span class="comment">// 为邮件操作设置不同的邮件内容</span></span><br><span class="line">    emailJob.setEmail(email);</span><br><span class="line">    </span><br><span class="line">    sms = <span class="keyword">new</span> Sms();</span><br><span class="line">    smsJob.setSms(sms);</span><br><span class="line">    </span><br><span class="line">    fileIO = <span class="keyword">new</span> FileIO();</span><br><span class="line">    fileIOJob.setFileIO(fileIO);</span><br><span class="line">    </span><br><span class="line">    logging = <span class="keyword">new</span> Logging();</span><br><span class="line">    logJob.setLogging(logging);</span><br><span class="line">      <span class="comment">// 每次发出四个命令</span></span><br><span class="line">    pool.addJob(emailJob);</span><br><span class="line">    pool.addJob(smsJob);</span><br><span class="line">    pool.addJob(fileIOJob);</span><br><span class="line">    pool.addJob(logJob);</span><br><span class="line">&#125;</span><br><span class="line">pool.shutdownPool();</span><br></pre></td></tr></table></figure>
<p>简化一下，其实就是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emailJob.setEmail(<span class="keyword">new</span> Email());</span><br><span class="line">emailJob.run();</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong></p>
<blockquote>
<p>命令模式的本质是对请求进行封装，<strong>一个请求对应于一个命令</strong>，将<strong>发出命令</strong>的责任和<strong>执行命令</strong>的责任分割开。命令模式允许<strong>请求的一方</strong>和<strong>接收的一方</strong>独立开来，使得请求的一方不必知道接收请求的一方的接口，更不必知道请求如何被接收、操作是否被执行、何时被执行，以及是怎么被执行的。</p>
</blockquote>
<h2 id="chain-of-responsibility-design-pattern-责任链模式"><a class="markdownIt-Anchor" href="#chain-of-responsibility-design-pattern-责任链模式"></a> Chain of responsibility design pattern | 责任链模式</h2>
<ul>
<li>Java 中的 try-catch，没有 catch 语句则会交给上一级进行处理。</li>
<li>斗地主时对于一张牌，每个人轮流进行处理（要的起、要不起）。</li>
<li>公司不同等级的财务支出需要不同的人审批。</li>
</ul>
<p><a href="../../../../2018/06/05/java-UML/"><strong>UML 类图：</strong></a></p>
<img src="chain-of-responsibility-uml.png">
<p><code>ConcreteHandler</code> 只处理有责任处理的事件，当无法处理时，交给后继者来处理。</p>
<p><strong>代码：</strong></p>
<p>抽象的 <code>Handler</code> 定义了自己不能处理是交给谁来处理的 <code>setHandler</code>，自己的处理方法 <code>process</code>。</p>
<details><summary>Handler.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.chainofresponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHandler</span><span class="params">(Handler handler)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(File file)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHandlerName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>它的一种实现，比如处理图片的 <code>Handler</code>。</p>
<details><summary>ImageFileHandler.java</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.chainofresponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageFileHandler</span> <span class="keyword">implements</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line">    <span class="keyword">private</span> String handlerName;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageFileHandler</span><span class="params">(String handlerName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.handlerName = handlerName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHandler</span><span class="params">(Handler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(file.getFileType().equals(<span class="string">"image"</span>))&#123;</span><br><span class="line">      <span class="comment">// 1. 恰好处理成功</span></span><br><span class="line">            System.out.println(<span class="string">"Process and saving image file... by "</span>+handlerName);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(handler!=<span class="keyword">null</span>)&#123;</span><br><span class="line">      <span class="comment">// 2. 交给后继者处理</span></span><br><span class="line">      <span class="comment">//    革命尚未成功，同志仍需努力</span></span><br><span class="line">            System.out.println(handlerName+<span class="string">" fowards request to "</span>+handler.getHandlerName());</span><br><span class="line">            handler.process(file);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">// 3. 后继无人 😭</span></span><br><span class="line">            System.out.println(<span class="string">"File not supported"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHandlerName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> handlerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>客户端用起来是这样的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javacodegeeks.patterns.chainofresponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestChainofResponsibility</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File file = <span class="keyword">null</span>;</span><br><span class="line">        Handler textHandler = <span class="keyword">new</span> TextFileHandler(<span class="string">"Text Handler"</span>);</span><br><span class="line">        Handler docHandler = <span class="keyword">new</span> DocFileHandler(<span class="string">"Doc Handler"</span>);</span><br><span class="line">        Handler excelHandler = <span class="keyword">new</span> ExcelFileHandler(<span class="string">"Excel Handler"</span>);</span><br><span class="line">        Handler audioHandler = <span class="keyword">new</span> AudioFileHandler(<span class="string">"Audio Handler"</span>);</span><br><span class="line">        Handler videoHandler = <span class="keyword">new</span> VideoFileHandler(<span class="string">"Video Handler"</span>);</span><br><span class="line">        Handler imageHandler = <span class="keyword">new</span> ImageFileHandler(<span class="string">"Image Handler"</span>);</span><br><span class="line">        </span><br><span class="line">        textHandler.setHandler(docHandler);</span><br><span class="line">        docHandler.setHandler(excelHandler);</span><br><span class="line">        excelHandler.setHandler(audioHandler);</span><br><span class="line">        audioHandler.setHandler(videoHandler);</span><br><span class="line">        videoHandler.setHandler(imageHandler);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        file = <span class="keyword">new</span> File(<span class="string">"Abc.mp3"</span>, <span class="string">"audio"</span>, <span class="string">"C:"</span>);</span><br><span class="line">        textHandler.process(file);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"---------------------------------"</span>);</span><br><span class="line">        </span><br><span class="line">        file = <span class="keyword">new</span> File(<span class="string">"Abc.jpg"</span>, <span class="string">"video"</span>, <span class="string">"C:"</span>);</span><br><span class="line">        textHandler.process(file);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"---------------------------------"</span>);</span><br><span class="line">        </span><br><span class="line">        file = <span class="keyword">new</span> File(<span class="string">"Abc.doc"</span>, <span class="string">"doc"</span>, <span class="string">"C:"</span>);</span><br><span class="line">        textHandler.process(file);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"---------------------------------"</span>);</span><br><span class="line">        </span><br><span class="line">        file = <span class="keyword">new</span> File(<span class="string">"Abc.bat"</span>, <span class="string">"bat"</span>, <span class="string">"C:"</span>);</span><br><span class="line">        textHandler.process(file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<details><summary>运行结果</summary>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Text Handler forwards request to Doc Handler</span><br><span class="line">Doc Handler forwards request to Excel Handler</span><br><span class="line">Excel Handler forwards request to Audio Handler</span><br><span class="line">Process and saving audio file... by Audio Handler</span><br><span class="line">---------------------------------</span><br><span class="line">Text Handler forwards request to Doc Handler</span><br><span class="line">Doc Handler forwards request to Excel Handler</span><br><span class="line">Excel Handler forwards request to Audio Handler</span><br><span class="line">Audio Handler forwards request to Video Handler</span><br><span class="line">Process and saving video file... by Video Handler</span><br><span class="line">---------------------------------</span><br><span class="line">Text Handler forwards request to Doc Handler</span><br><span class="line">Process and saving doc file... by Doc Handler</span><br><span class="line">---------------------------------</span><br><span class="line">Text Handler forwards request to Doc Handler</span><br><span class="line">Doc Handler forwards request to Excel Handler</span><br><span class="line">Excel Handler forwards request to Audio Handler</span><br><span class="line">Audio Handler forwards request to Video Handler</span><br><span class="line">Video Handler forwards request to Image Handler</span><br><span class="line">File not supported</span><br></pre></td></tr></table></figure>
</details>
<h1 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h1>
<table>
<thead>
<tr>
<th style="text-align:center">创建型模式</th>
<th style="text-align:center">结构型模式</th>
<th style="text-align:center">行为型模式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">简单工厂模式</td>
<td style="text-align:center">桥接模式</td>
<td style="text-align:center">观察者模式</td>
</tr>
<tr>
<td style="text-align:center">工厂方法模式</td>
<td style="text-align:center">代理模式</td>
<td style="text-align:center">访问者模式</td>
</tr>
<tr>
<td style="text-align:center">抽象工厂模式</td>
<td style="text-align:center">组合模式</td>
<td style="text-align:center">中介者模式</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">命令模式</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">责任链模式</td>
</tr>
</tbody>
</table>
<ol>
<li><a href="https://github.com/upupming/books/blob/master/Programming-Languages/java/Java-Design-Patterns.pdf" target="_blank" rel="noopener">Java Design Patterns</a></li>
<li>Software Construction at HIT | 6.2 Design Patterns for Maintainability</li>
<li><a href="https://legacy.gitbook.com/book/quanke/design-pattern-java/details" target="_blank" rel="noopener">设计模式Java版</a></li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">upupming</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://upupming.site/2018/06/19/java-design-patterns-2/">https://upupming.site/2018/06/19/java-design-patterns-2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://upupming.site">upupming 的博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/design-patterns/">design patterns</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/06/22/multi-dimensional-software-views/"><i class="fa fa-chevron-left">  </i><span>软件的多维度视图</span></a></div><div class="next-post pull-right"><a href="/2018/06/18/java-design-patterns-1/"><span>Java 设计模式 (1)</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '77bd7cc3fdbcd3e5945a',
  clientSecret: '883971da140a8232d72918030f8c1a211a5befc1',
  repo: 'upupming.github.io',
  owner: 'upupming',
  admin: 'upupming',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(/img/background.png)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2020 By upupming</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/algolia.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>